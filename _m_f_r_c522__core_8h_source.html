<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>avr.sdk:  Fichier source de include/RFID/MFRC522_core.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">avr.sdk
   </div>
   <div id="projectbrief">SDK pour les projets AVR</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Généré par Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Recherche');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Page&#160;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&#160;associées</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Structures&#160;de&#160;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Recherche" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Liste&#160;des&#160;fichiers</span></a></li>
      <li><a href="globals.html"><span>Variables&#160;globale</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_m_f_r_c522__core_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MFRC522_core.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_m_f_r_c522__core_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * @file      MFRC522_core.h</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * @author    Zéro Cool</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * @date      15/06/2015 18:13:32</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * @brief     Coeur de la bibliothèque de contrôle du lecteur MFRC522</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * @details   Coeur de la bibliothèque d&#39;utilisation du reader RFID MFRC522 en mode SPI.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * @todo      Revoir les commentaires des enum</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * @ingroup   RFID</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#ifndef _MFRC522_CORE_H_</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#define _MFRC522_CORE_H_</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;avr/pgmspace.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;util/delay.h&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="_s_p_i__master_8h.html">SPI_master.h</a>&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">   26</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">// Page 0 : Commandes et statut</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="comment">//                          0x00    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">   30</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>        = 0x01,   </div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a93a13da90845d8c9c3fa78c158854195">   31</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a93a13da90845d8c9c3fa78c158854195">PCD_REG_ComIEnReg</a>         = 0x02,   </div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a856c2fbda471317477c4d9c6f6f51cf5">   32</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a856c2fbda471317477c4d9c6f6f51cf5">PCD_REG_DivIEnReg</a>         = 0x03,   </div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33adaea6b5804a6d640dbff5105949f5404">   33</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33adaea6b5804a6d640dbff5105949f5404">PCD_REG_ComIrqReg</a>         = 0x04,   </div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4">   34</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4">PCD_REG_DivIrqReg</a>         = 0x05,   </div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a616cf0f1c0e035e8336b0f20617e7804">   35</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a616cf0f1c0e035e8336b0f20617e7804">PCD_REG_ErrorReg</a>          = 0x06,   </div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aaaaf507911a757965d739733b9ae6535">   36</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aaaaf507911a757965d739733b9ae6535">PCD_REG_Status1Reg</a>        = 0x07,   </div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a8d6496f8cf42e6dcb95019637816fec4">   37</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a8d6496f8cf42e6dcb95019637816fec4">PCD_REG_Status2Reg</a>        = 0x08,   </div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">   38</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>       = 0x09,   </div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">   39</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">PCD_REG_FIFOLevelReg</a>      = 0x0A,   </div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ad79b77a72609cf7e4b631057980c480e">   40</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ad79b77a72609cf7e4b631057980c480e">PCD_REG_WaterLevelReg</a>     = 0x0B,   </div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0f45f3bb94d961288e224e6262f36ee0">   41</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0f45f3bb94d961288e224e6262f36ee0">PCD_REG_ControlReg</a>        = 0x0C,   </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33accd00177ef7a31226e85829a313cfaf2">   42</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33accd00177ef7a31226e85829a313cfaf2">PCD_REG_BitFramingReg</a>     = 0x0D,   </div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a9400548ad6bc1533ae1759ab5633f31e">   43</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a9400548ad6bc1533ae1759ab5633f31e">PCD_REG_CollReg</a>           = 0x0E,   </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">//                          0x0F    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">// Page 1 : Commandes</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">//                          0x10    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6f0c083085742b3390c0251ebaa1734d">   48</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6f0c083085742b3390c0251ebaa1734d">PCD_REG_ModeReg</a>           = 0x11,   </div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a74cf62f3f9d28ce418914030cc75aecc">   49</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a74cf62f3f9d28ce418914030cc75aecc">PCD_REG_TxModeReg</a>         = 0x12,   </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3bea9206a0e75952543dc4947f08ba68">   50</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3bea9206a0e75952543dc4947f08ba68">PCD_REG_RxModeReg</a>         = 0x13,   </div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e">   51</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e">PCD_REG_TxControlReg</a>      = 0x14,   </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a4e859fdaca136ea69b6d1a15d8ce42bb">   52</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a4e859fdaca136ea69b6d1a15d8ce42bb">PCD_REG_TxASKReg</a>          = 0x15,   </div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa643aee0562bf611da3d63b699cc1d9d">   53</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa643aee0562bf611da3d63b699cc1d9d">PCD_REG_TxSelReg</a>          = 0x16,   </div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33af6af9e44f1c02fcd57f431ff969b5361">   54</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33af6af9e44f1c02fcd57f431ff969b5361">PCD_REG_RxSelReg</a>          = 0x17,   </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ab1dbe3f2cc2589509b9d77e34ee757b5">   55</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ab1dbe3f2cc2589509b9d77e34ee757b5">PCD_REG_RxThresholdReg</a>    = 0x18,   </div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a19dad8f8313437c0428a8e885aa78042">   56</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a19dad8f8313437c0428a8e885aa78042">PCD_REG_DemodReg</a>          = 0x19,   </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">//                          0x1A    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">//                          0x1B    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a47e79ac1154ef547083e9b62ac4560b5">   59</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a47e79ac1154ef547083e9b62ac4560b5">PCD_REG_MfTxReg</a>           = 0x1C,   </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa5ca6010d626de6318c497b2e030a772">   60</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa5ca6010d626de6318c497b2e030a772">PCD_REG_MfRxReg</a>           = 0x1D,   </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">//                          0x1E    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33af1a20c58c7ab38f5ad570897536a13b8">   62</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33af1a20c58c7ab38f5ad570897536a13b8">PCD_REG_SerialSpeedReg</a>    = 0x1F,   </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">// Page 2 : Configuration</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">//                          0x20    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a62df1eebf0e1a19452da8ba6d05fea5e">   66</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a62df1eebf0e1a19452da8ba6d05fea5e">PCD_REG_CRCResultRegH</a>         = 0x21,   </div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a134cfc31312e5d90455e362f4ba2b3a9">   67</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a134cfc31312e5d90455e362f4ba2b3a9">PCD_REG_CRCResultRegL</a>         = 0x22,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">//                          0x23    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a580beecddfd163115ca42f7e42d860f7">   69</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a580beecddfd163115ca42f7e42d860f7">PCD_REG_ModWidthReg</a>               = 0x24,   </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">//                          0x25    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935">   71</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935">PCD_REG_RFCfgReg</a>          = 0x26,   </div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aff575332e484bda25f49d6fcaf9a0d65">   72</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aff575332e484bda25f49d6fcaf9a0d65">PCD_REG_GsNReg</a>            = 0x27,   </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33afb39e1757ce1146f7919c3ede2e66898">   73</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33afb39e1757ce1146f7919c3ede2e66898">PCD_REG_CWGsPReg</a>          = 0x28,   </div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a358eb8a41e72d3378f64f8028f600cae">   74</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a358eb8a41e72d3378f64f8028f600cae">PCD_REG_ModGsPReg</a>         = 0x29,   </div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6a4b20418e3ddc86f980380cb902d448">   75</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6a4b20418e3ddc86f980380cb902d448">PCD_REG_TModeReg</a>          = 0x2A,   </div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a2dc37d32070c817377788f04bcf65e1a">   76</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a2dc37d32070c817377788f04bcf65e1a">PCD_REG_TPrescalerReg</a>     = 0x2B,   </div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3547fc0462c7e2b611d68166b1a762c7">   77</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3547fc0462c7e2b611d68166b1a762c7">PCD_REG_TReloadRegH</a>       = 0x2C,   </div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1878873f3f0b1e4fe42901727fb1d048">   78</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1878873f3f0b1e4fe42901727fb1d048">PCD_REG_TReloadRegL</a>       = 0x2D,</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa678740b68bf4ea2037a14599ebd0057">   79</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa678740b68bf4ea2037a14599ebd0057">PCD_REG_TCounterValueRegH</a> = 0x2E,   </div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac745e1397e9a60e76b19248531491ba9">   80</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac745e1397e9a60e76b19248531491ba9">PCD_REG_TCounterValueRegL</a> = 0x2F,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// Page 3 : Registres de tests</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">//                          0x30    /**&lt; reserved for future use */</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a241b6b48319cb0bcd71dfb7c71550873">   84</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a241b6b48319cb0bcd71dfb7c71550873">PCD_REG_TestSel1Reg</a>       = 0x31,   </div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac0d6b81c1c0d8673b2419576a5a413ae">   85</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac0d6b81c1c0d8673b2419576a5a413ae">PCD_REG_TestSel2Reg</a>       = 0x32,   </div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a7a43eff2d34ea3415e08e1d7e5f0bdd5">   86</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a7a43eff2d34ea3415e08e1d7e5f0bdd5">PCD_REG_TestPinEnReg</a>      = 0x33,   </div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a7cfb5852dc3490759c7c6e464a6bd3a9">   87</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a7cfb5852dc3490759c7c6e464a6bd3a9">PCD_REG_TestPinValueReg</a>   = 0x34,   </div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33afd742d6b7e591346eb016c6d6905e15f">   88</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33afd742d6b7e591346eb016c6d6905e15f">PCD_REG_TestBusReg</a>        = 0x35,   </div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac871c1931c8c16ead48a0b25fec172c2">   89</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac871c1931c8c16ead48a0b25fec172c2">PCD_REG_AutoTestReg</a>       = 0x36,   </div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa112c84e0638974eecc772d6e16c7433">   90</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa112c84e0638974eecc772d6e16c7433">PCD_REG_VersionReg</a>        = 0x37,   </div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1becdd93cb0549cd762640c1931c3ed9">   91</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1becdd93cb0549cd762640c1931c3ed9">PCD_REG_AnalogTestReg</a>     = 0x38,   </div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ae3a1ca472ee1a44cedb6278b002ce71b">   92</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ae3a1ca472ee1a44cedb6278b002ce71b">PCD_REG_TestDAC1Reg</a>       = 0x39,   </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a5fc5700e251a02d8b88403905fda17da">   93</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a5fc5700e251a02d8b88403905fda17da">PCD_REG_TestDAC2Reg</a>       = 0x3A,   </div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a87bce03f7e7673fe3e14b301173ad443">   94</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a87bce03f7e7673fe3e14b301173ad443">PCD_REG_TestADCReg</a>        = 0x3B    </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">//                          0x3C    /**&lt; reserved for production tests */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">//                          0x3D    /**&lt; reserved for production tests */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">//                          0x3E    /**&lt; reserved for production tests */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">//                          0x3F    /**&lt; reserved for production tests */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;} <a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129">  105</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">  107</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">PCD_CMD_Idle</a>              = 0x00,   </div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a21cfbed66ddd5ea30f1e18718f38822b">  108</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a21cfbed66ddd5ea30f1e18718f38822b">PCD_CMD_Mem</a>               = 0x01,   </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a84cc983cf30be66f1a9c77e9434dab06">  109</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a84cc983cf30be66f1a9c77e9434dab06">PCD_CMD_GenerateRandomID</a>  = 0x02,   </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a8f646ea639231f41c7adef64ef256792">  110</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a8f646ea639231f41c7adef64ef256792">PCD_CMD_CalcCRC</a>           = 0x03,   </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129ac4e63bc2d9f070830d7381c1b469108d">  111</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129ac4e63bc2d9f070830d7381c1b469108d">PCD_CMD_Transmit</a>          = 0x04,   </div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129afe10d8d4db13ee062d6c8420932ad0ef">  112</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129afe10d8d4db13ee062d6c8420932ad0ef">PCD_CMD_NoCmdChange</a>       = 0x07,   </div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129acbfb109197e667e9a10428e26f554eec">  113</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129acbfb109197e667e9a10428e26f554eec">PCD_CMD_Receive</a>           = 0x08,   </div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17">  114</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17">PCD_CMD_Transceive</a>        = 0x0C,   </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a9f1455eb011b595fce71f1c334c3452b">  115</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a9f1455eb011b595fce71f1c334c3452b">PCD_CMD_MFAuthent</a>         = 0x0E,   </div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a5db5c6c4a64c5846a677753cf75ad187">  116</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a5db5c6c4a64c5846a677753cf75ad187">PCD_CMD_SoftReset</a>         = 0x0F    </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;} <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129">PCD_CMD</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500ac">  123</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// The commands used by the PCD to manage communication with several PICCs (ISO 14443-3, Type A, section 6.4)</span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad213da8df255bc6ff7cca5b7a28da7b4">  126</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad213da8df255bc6ff7cca5b7a28da7b4">PICC_CMD_REQA</a>             = 0x26,   </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95cc086aa9fc83fe999b43f6c508ff19">  127</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95cc086aa9fc83fe999b43f6c508ff19">PICC_CMD_WUPA</a>             = 0x52,   </div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acae53647ddb4c2765fff8814805310113c">  128</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acae53647ddb4c2765fff8814805310113c">PICC_CMD_CT</a>               = 0x88,   </div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca6cd44287b13b4ac175b38bde5ef61f5b">  129</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca6cd44287b13b4ac175b38bde5ef61f5b">PICC_CMD_SEL_CL1</a>          = 0x93,   </div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab072baf2abb9cadd0205b8809bf0de95">  130</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab072baf2abb9cadd0205b8809bf0de95">PICC_CMD_SEL_CL2</a>          = 0x95,   </div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca2fc1e0ba00730e380391575d5660309a">  131</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca2fc1e0ba00730e380391575d5660309a">PICC_CMD_SEL_CL3</a>          = 0x97,   </div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca881588d3cca42490c71666c97b55a6c8">  132</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca881588d3cca42490c71666c97b55a6c8">PICC_CMD_HLTA</a>             = 0x50,   </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// The commands used for MIFARE Classic (from http://www.nxp.com/documents/data_sheet/MF1S503x.pdf, Section 9)</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// Use PCD_MFAuthent to authenticate access to a sector, then use these commands to read/write/modify the blocks on the sector.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// The read/write commands can also be used for MIFARE Ultralight.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaed599c1a5ba157455ed438315406c305">  136</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaed599c1a5ba157455ed438315406c305">PICC_CMD_MF_AUTH_KEY_A</a>    = 0x60,   </div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95ad7ce4f4272886b6756b49f3aeaf9a">  137</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95ad7ce4f4272886b6756b49f3aeaf9a">PICC_CMD_MF_AUTH_KEY_B</a>    = 0x61,   </div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad2cedf2b5b620a6d874f0b8360e7e36c">  138</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad2cedf2b5b620a6d874f0b8360e7e36c">PICC_CMD_MF_READ</a>          = 0x30,   </div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab328a35286d092e483fa370d1868e44e">  139</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab328a35286d092e483fa370d1868e44e">PICC_CMD_MF_WRITE</a>         = 0xA0,   </div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0329cc76c269606689b6c3b35683136c">  140</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0329cc76c269606689b6c3b35683136c">PICC_CMD_MF_DECREMENT</a>     = 0xC0,   </div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0a14c55a640535db5c46ce0110df7a44">  141</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0a14c55a640535db5c46ce0110df7a44">PICC_CMD_MF_INCREMENT</a>     = 0xC1,   </div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaebf925b876166923f98130644349e6ec">  142</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaebf925b876166923f98130644349e6ec">PICC_CMD_MF_RESTORE</a>       = 0xC2,   </div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca8985fa08e3634abc0229923901e5bd97">  143</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca8985fa08e3634abc0229923901e5bd97">PICC_CMD_MF_TRANSFER</a>      = 0xB0,   </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// The commands used for MIFARE Ultralight (from http://www.nxp.com/documents/data_sheet/MF0ICU1.pdf, Section 8.6)</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// The PICC_CMD_MF_READ and PICC_CMD_MF_WRITE can also be used for MIFARE Ultralight.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca09929cac708d474115bdcb25f3d61f81">  146</a></span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca09929cac708d474115bdcb25f3d61f81">PICC_CMD_UL_WRITE</a>         = 0xA2    </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;} <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500ac">PICC_CMD</a>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a732edd02a7cbbaae5ce91d4e5db92659">  153</a></span>&#160;<span class="keyword">const</span> uint8_t PROGMEM <a class="code" href="_m_f_r_c522__core_8h.html#a732edd02a7cbbaae5ce91d4e5db92659">MFRC522_firmware_referenceV1_0</a>[] = {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    0x00, 0xC6, 0x37, 0xD5, 0x32, 0xB7, 0x57, 0x5C,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    0xC2, 0xD8, 0x7C, 0x4D, 0xD9, 0x70, 0xC7, 0x73,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    0x10, 0xE6, 0xD2, 0xAA, 0x5E, 0xA1, 0x3E, 0x5A,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    0x14, 0xAF, 0x30, 0x61, 0xC9, 0x70, 0xDB, 0x2E,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    0x64, 0x22, 0x72, 0xB5, 0xBD, 0x65, 0xF4, 0xEC,</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    0x22, 0xBC, 0xD3, 0x72, 0x35, 0xCD, 0xAA, 0x41,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    0x1F, 0xA7, 0xF3, 0x53, 0x14, 0xDE, 0x7E, 0x02,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    0xD9, 0x0F, 0xB5, 0x5E, 0x25, 0x1D, 0x29, 0x79</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;};</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#addc9d748d171be1bb8a76dd80e10452f">  168</a></span>&#160;<span class="keyword">const</span> uint8_t PROGMEM <a class="code" href="_m_f_r_c522__core_8h.html#addc9d748d171be1bb8a76dd80e10452f">MFRC522_firmware_referenceV2_0</a>[] = {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    0x00, 0xEB, 0x66, 0xBA, 0x57, 0xBF, 0x23, 0x95,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    0xD0, 0xE3, 0x0D, 0x3D, 0x27, 0x89, 0x5C, 0xDE,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    0x9D, 0x3B, 0xA7, 0x00, 0x21, 0x5B, 0x89, 0x82,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    0x51, 0x3A, 0xEB, 0x02, 0x0C, 0xA5, 0x00, 0x49,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    0x7C, 0x84, 0x4D, 0xB3, 0xCC, 0xD2, 0x1B, 0x81,</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    0x5D, 0x48, 0x76, 0xD5, 0x71, 0x61, 0x21, 0xA9,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    0x86, 0x96, 0x83, 0x38, 0xCF, 0x9D, 0x5B, 0x6D,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    0xDC, 0x15, 0xBA, 0x3E, 0x7D, 0x95, 0x3B, 0x2F</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;};</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a0b8d835ea355a4817462616596bf9bff">  183</a></span>&#160;<span class="keyword">const</span> uint8_t PROGMEM <a class="code" href="_m_f_r_c522__core_8h.html#a0b8d835ea355a4817462616596bf9bff">FM17522_firmware_reference</a>[] = {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    0x00, 0xD6, 0x78, 0x8C, 0xE2, 0xAA, 0x0C, 0x18,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    0x2A, 0xB8, 0x7A, 0x7F, 0xD3, 0x6A, 0xCF, 0x0B,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    0xB1, 0x37, 0x63, 0x4B, 0x69, 0xAE, 0x91, 0xC7,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    0xC3, 0x97, 0xAE, 0x77, 0xF4, 0x37, 0xD7, 0x9B,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    0x7C, 0xF5, 0x3C, 0x11, 0x8F, 0x15, 0xC3, 0xD7,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    0xC1, 0x5B, 0x00, 0x2A, 0xD0, 0x75, 0xDE, 0x9E,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    0x51, 0x64, 0xAB, 0x3E, 0xE9, 0x15, 0xB5, 0xAB,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    0x56, 0x9A, 0x98, 0x82, 0x26, 0xEA, 0x2A, 0x62</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;};</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a39edefa4be0db73b639644f19aa79bbc">  197</a></span>&#160;<span class="preprocessor">#define MFRC522_MIFARE_ACK       0xA</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">// Fonctions de base pour communiquer avec le MFRC522</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">  210</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a> reg, uint8_t value)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a2eb086fbbace1373fea415c9cc9953d3">SPI_EnableSlave</a>();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// MSB == 0 pour l&#39;écriture. LSB n&#39;est pas utilisé pour l&#39;adresse. Paragraphe 8.1.2.3 de la datasheet.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>((reg &lt;&lt; 1) &amp; 0x7E);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(value);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a1a7159977e7a69ed49beed0a2019af9b">SPI_DisableSlave</a>();</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a3a1008b2ed0db7a80ab790224d5c6101">  231</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a3a1008b2ed0db7a80ab790224d5c6101">MFRC522_PCD_WriteRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a> reg, uint8_t count, uint8_t * values)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a2eb086fbbace1373fea415c9cc9953d3">SPI_EnableSlave</a>();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// MSB == 0 pour l&#39;écriture. LSB n&#39;est pas utilisé pour l&#39;adresse. Paragraphe 8.1.2.3 de la datasheet.</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>((reg &lt;&lt; 1) &amp; 0x7E);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; count; i++)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(values[i]);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a1a7159977e7a69ed49beed0a2019af9b">SPI_DisableSlave</a>();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">  251</a></span>&#160;uint8_t <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a> reg)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;{</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  uint8_t value;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a2eb086fbbace1373fea415c9cc9953d3">SPI_EnableSlave</a>();</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// MSB == 1 pour la lecture. LSB n&#39;est pas utilisé pour l&#39;adresse. Paragraphe 8.1.2.3 de la datasheet.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(0x80 | ((reg &lt;&lt; 1) &amp; 0x7E));</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  value = <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(0x00);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a1a7159977e7a69ed49beed0a2019af9b">SPI_DisableSlave</a>();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">return</span> value;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a42cba06e7ef4cfa9afba588d7273e674">  274</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a42cba06e7ef4cfa9afba588d7273e674">MFRC522_PCD_ReadRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a> reg, uint8_t count, uint8_t * values, uint8_t rxAlign)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">if</span> (count == 0)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// MSB == 1 pour la lecture. LSB n&#39;est pas utilisé pour l&#39;adresse. Paragraphe 8.1.2.3 de la datasheet.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  uint8_t address = 0x80 | ((reg &lt;&lt; 1) &amp; 0x7E);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// Index dans le tableau résultat &quot;values&quot;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  uint8_t index = 0;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a2eb086fbbace1373fea415c9cc9953d3">SPI_EnableSlave</a>();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// Première lecture</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  count--;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// On indique quelle adresse nous désirons lire</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(address);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Tant qu&#39;il reste des choses à lire</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">while</span> (index &lt; count)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (index == 0 &amp;&amp; rxAlign)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="comment">// Only update bit positions rxAlign..7 in values[0]</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="comment">// Create bit mask for bit positions rxAlign..7</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      uint8_t mask = 0;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">for</span> (uint8_t i = rxAlign; i &lt;= 7; i++)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        mask |= (1 &lt;&lt; i);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">// Lecture de la valeur totu en indiquant que l&#39;on veut encore lire la même adresse</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      uint8_t value = <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(address);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="comment">// Apply mask to both current value of values[0] and the new data in value.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      values[0] = (values[index] &amp; ~mask) | (value &amp; mask);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">// Lecture normale</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="comment">// Lecture de la valeur totu en indiquant que l&#39;on veut encore lire la même adresse</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      values[index] = <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(address);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    index++;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">// Lecture de l&#39;octet terminal</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  values[index] = <a class="code" href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a>(0x00);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a1a7159977e7a69ed49beed0a2019af9b">SPI_DisableSlave</a>();</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">  333</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a> reg, uint8_t mask)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  uint8_t tmp = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(reg);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(reg, tmp | mask);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">  345</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a> reg, uint8_t mask)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  uint8_t tmp = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(reg);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(reg, tmp &amp; (~mask));</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">  363</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a>(uint8_t * data, uint8_t length, uint16_t * result)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">PCD_CMD_Idle</a>);       <span class="comment">// Arrêt de toute commande en cours</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4">PCD_REG_DivIrqReg</a>, 0x04);                <span class="comment">// Netoyage du bit d&#39;intéruption CRCIRq</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">PCD_REG_FIFOLevelReg</a>, 0x80);        <span class="comment">// FlushBuffer = 1, FIFO initialization</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3a1008b2ed0db7a80ab790224d5c6101">MFRC522_PCD_WriteRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>, length, data);      <span class="comment">// Ecriture des données dans la FIFO</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a8f646ea639231f41c7adef64ef256792">PCD_CMD_CalcCRC</a>);    <span class="comment">// Démarrage du calcul du CRC</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">// Attente que le calcul du CRC soit terminé. (Chaque itération prent 17.73us)</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  uint16_t i = 5000;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  uint8_t n;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">// DivIrqReg[7..0] bits are: Set2 reserved reserved MfinActIRq reserved CRCIRq reserved reserved</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    n = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4">PCD_REG_DivIrqReg</a>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// Si le bit CRCIRq est positionné, c&#39;est que le calcul du CRC est terminé</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (n &amp; 0x04)</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// Timeout si le calcul est trop long (89ms environ)</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (--i == 0)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386">MFRC522_STATUS_TIMEOUT</a>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">// Arrêt du calcul du CRC</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">PCD_CMD_Idle</a>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">// Transfert du réulstat du registre en sortie</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  *result  = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a134cfc31312e5d90455e362f4ba2b3a9">PCD_REG_CRCResultRegL</a>) &lt;&lt; 8;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  *result |= <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a62df1eebf0e1a19452da8ba6d05fea5e">PCD_REG_CRCResultRegH</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a88c1a46eaee837f136ab9ad8caa01b95">  402</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a88c1a46eaee837f136ab9ad8caa01b95">MFRC522_PCD_Reset</a>()</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a5db5c6c4a64c5846a677753cf75ad187">PCD_CMD_SoftReset</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  _delay_us(37.74);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>) &amp; _BV(4))</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// Le PCD est toujours en train de rebooter... Il faut attendre !</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#acdbe3a27cd1e8f170a87b42b9fc1a43e">  412</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#acdbe3a27cd1e8f170a87b42b9fc1a43e">MFRC522_PCD_AntennaOn</a>()</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  uint8_t value = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e">PCD_REG_TxControlReg</a>);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">if</span> ((value &amp; 0x03) != 0x03)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e">PCD_REG_TxControlReg</a>, value | 0x03);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a39abb1141be87a84f525ea22f555ab20">  421</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a39abb1141be87a84f525ea22f555ab20">MFRC522_PCD_AntennaOff</a>()</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e">PCD_REG_TxControlReg</a>, 0x03);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aa75102bb88c62cd9c384199c491f3045">  426</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#aa75102bb88c62cd9c384199c491f3045">MFRC522_PCD_Init</a>()</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;{</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#afe52fd1b883a29133b7a8974837e0c4b">SPI_Initialize</a>();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="_s_p_i__master_8h.html#a1a7159977e7a69ed49beed0a2019af9b">SPI_DisableSlave</a>();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// Broche Reset en sortie</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  MFRC522_DDR |=  _BV(MFRC522_RESET_PIN);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> (!(MFRC522_PORT &amp; _BV(MFRC522_RESET_PIN)))</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// Reset PIN to Hi</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    MFRC522_PORT |=  _BV(MFRC522_RESET_PIN);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// Attente de 37,4us le temps que le cristal ce mette en route (Cf. Section 8.8.2)</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    _delay_us(37.74);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// Reset par software</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="_m_f_r_c522__core_8h.html#a88c1a46eaee837f136ab9ad8caa01b95">MFRC522_PCD_Reset</a>();</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">// When communicating with a PICC we need a timeout if something goes wrong.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// f_timer = 13.56 MHz / (2*TPreScaler+1) where TPreScaler = [TPrescaler_Hi:TPrescaler_Lo].</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">// TPrescaler_Hi are the four low bits in TModeReg. TPrescaler_Lo is TPrescalerReg.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">// TAuto=1; timer starts automatically at the end of the transmission in all communication modes at all speeds</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6a4b20418e3ddc86f980380cb902d448">PCD_REG_TModeReg</a>, 0x80);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// TPreScaler = TModeReg[3..0]:TPrescalerReg, ie 0x0A9 = 169 =&gt; f_timer=40kHz, ie a timer period of 25us.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a2dc37d32070c817377788f04bcf65e1a">PCD_REG_TPrescalerReg</a>, 0xA9);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// Reload timer with 0x3E8 = 1000, ie 25ms before timeout.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3547fc0462c7e2b611d68166b1a762c7">PCD_REG_TReloadRegH</a>, 0x03);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1878873f3f0b1e4fe42901727fb1d048">PCD_REG_TReloadRegL</a>, 0xE8);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// Default 0x00. Force a 100 % ASK modulation independent of the ModGsPReg register setting</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a4e859fdaca136ea69b6d1a15d8ce42bb">PCD_REG_TxASKReg</a>, 0x40);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// Default 0x3F. Set the preset value for the CRC coprocessor for the CalcCRC command to 0x6363 (ISO 14443-3 part 6.2.4)</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6f0c083085742b3390c0251ebaa1734d">PCD_REG_ModeReg</a>, 0x3D);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">// Enable the antenna driver pins TX1 and TX2 (they were disabled by the reset)</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#acdbe3a27cd1e8f170a87b42b9fc1a43e">MFRC522_PCD_AntennaOn</a>();</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;}</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a57a4e9574d9d35a55d97736855c2a79e">  468</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8747255baf96533a382042038f5d01e2">MFRC522_RX_GAIN</a> <a class="code" href="_m_f_r_c522__core_8h.html#a57a4e9574d9d35a55d97736855c2a79e">MFRC522_PCD_GetAntennaGain</a>()</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;{</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935">PCD_REG_RFCfgReg</a>) &amp; (0x07&lt;&lt;4)) &gt;&gt; 4;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a65ebd01d137d21794cbb3649189006ca">  473</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a65ebd01d137d21794cbb3649189006ca">MFRC522_PCD_SetAntennaGain</a>(<a class="code" href="_m_f_r_c522_8h.html#a8747255baf96533a382042038f5d01e2">MFRC522_RX_GAIN</a> gain)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;{</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_m_f_r_c522__core_8h.html#a57a4e9574d9d35a55d97736855c2a79e">MFRC522_PCD_GetAntennaGain</a>() != gain)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">// clear needed to allow 000 pattern</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935">PCD_REG_RFCfgReg</a>, (0x07&lt;&lt;4));</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// only set RxGain[2:0] bits</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935">PCD_REG_RFCfgReg</a>, (gain &lt;&lt; 4) &amp; (0x07&lt;&lt;4));</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a38cc59bf61d2bff44a84e0e89db78fbb">  484</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a38cc59bf61d2bff44a84e0e89db78fbb">MFRC522_PCD_PerformSelfTest</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;{</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// On effectue les étapes définie dans le paragraphe 16.1.1 de la datasheet</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// 1. Soft Reset</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a88c1a46eaee837f136ab9ad8caa01b95">MFRC522_PCD_Reset</a>();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">// 2. Initialisation du buffer interne avec 25 octets à 0x00.</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  uint8_t zeroes[25] = {0x00};</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">PCD_REG_FIFOLevelReg</a>, 0x80);        <span class="comment">// Vidage de la FIFO</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3a1008b2ed0db7a80ab790224d5c6101">MFRC522_PCD_WriteRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>, 25, zeroes);   <span class="comment">// Ecriture des 25 octets vide dans la FIFO</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a21cfbed66ddd5ea30f1e18718f38822b">PCD_CMD_Mem</a>);        <span class="comment">// Transfert des données dans la mémoire interne</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">// 3. Activation du self-test</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac871c1931c8c16ead48a0b25fec172c2">PCD_REG_AutoTestReg</a>, 0x09);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">// 4. Ecriture d&#39;un octet à 0x00 dans la FIFO</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>, 0x00);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="comment">// 5. Démarrage du test en démarrant le calcul CRC</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a8f646ea639231f41c7adef64ef256792">PCD_CMD_CalcCRC</a>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="comment">// 6. Attente de la fin du test</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 0xFF; i++)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">// DivIrqReg[7..0] bits are: Set2 reserved reserved MfinActIRq reserved CRCIRq reserved reserved</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    uint8_t n = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4">PCD_REG_DivIrqReg</a>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">// CRCIRq bit set - calculation done</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">if</span> (n &amp; 0x04)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">PCD_CMD_Idle</a>);      <span class="comment">// Stop calculating CRC for new content in the FIFO.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="comment">// 7. Lecture des 64 octets de la FIFO</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  uint8_t result[64];</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a42cba06e7ef4cfa9afba588d7273e674">MFRC522_PCD_ReadRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>, 64, result, 0);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// Fin du Self test</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">// On réinitialise le registre AutoTestReg pour revenir à la normal</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac871c1931c8c16ead48a0b25fec172c2">PCD_REG_AutoTestReg</a>, 0x00);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// Détermination de la version du firmware (Cf. paragraphe 9.3.4.8 de la datasheet)</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  uint8_t version = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa112c84e0638974eecc772d6e16c7433">PCD_REG_VersionReg</a>);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">// Pick the appropriate reference values</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keyword">const</span> uint8_t * reference;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">switch</span> (version)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// Fudan Semiconductor FM17522 clone</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">case</span> 0x88:</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      reference = <a class="code" href="_m_f_r_c522__core_8h.html#a0b8d835ea355a4817462616596bf9bff">FM17522_firmware_reference</a>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// Version 1.0</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">case</span> 0x91:</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      reference = <a class="code" href="_m_f_r_c522__core_8h.html#a732edd02a7cbbaae5ce91d4e5db92659">MFRC522_firmware_referenceV1_0</a>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// Version 2.0</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">case</span> 0x92:</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      reference = <a class="code" href="_m_f_r_c522__core_8h.html#addc9d748d171be1bb8a76dd80e10452f">MFRC522_firmware_referenceV2_0</a>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// Version inconnue</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">// Vérification du résultat</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 64; i++)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span> (result[i] != pgm_read_byte(&amp;(reference[i])))</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">// Functions for communicating with PICCs</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a5f030b32e2182ae7b70398bf5f38095b">  594</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a5f030b32e2182ae7b70398bf5f38095b">MFRC522_PCD_CommunicateWithPICC</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129">PCD_CMD</a> command, uint8_t waitIrq, uint8_t * sendData, uint8_t sendLen, uint8_t * backData,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  uint8_t * backLen, uint8_t * validBits, uint8_t rxAlign, uint8_t checkCRC)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;{</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  uint8_t n;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  uint8_t _validBits = 0;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">// Préparation des valeurs pour le registre PCD_REG_BitFramingReg</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  uint8_t txLastBits = 0;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keywordflow">if</span> (validBits != NULL)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    txLastBits = *validBits;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">// RxAlign    = BitFramingReg[6..4]</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  uint8_t bitFraming = (rxAlign &lt;&lt; 4) + txLastBits;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">// Stop any active command.</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">PCD_CMD_Idle</a>);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// Clear all seven interrupt request bits</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33adaea6b5804a6d640dbff5105949f5404">PCD_REG_ComIrqReg</a>, 0x7F);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="comment">// FlushBuffer = 1, FIFO initialization</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">PCD_REG_FIFOLevelReg</a>, 0x80);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">// Write sendData to the FIFO</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a3a1008b2ed0db7a80ab790224d5c6101">MFRC522_PCD_WriteRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>, sendLen, sendData);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// Bit adjustments</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33accd00177ef7a31226e85829a313cfaf2">PCD_REG_BitFramingReg</a>, bitFraming);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="comment">// Execute the command</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a>, command);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keywordflow">if</span> (command == <a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17">PCD_CMD_Transceive</a>)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">// StartSend=1, transmission of data starts</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33accd00177ef7a31226e85829a313cfaf2">PCD_REG_BitFramingReg</a>, 0x80);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">// Wait for the command to complete.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// In MFRC522_PCD_Init() we set the TAuto flag in TModeReg. This means the timer automatically starts when the PCD stops transmitting.</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// Each iteration of the do-while-loop takes 17.86us.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  uint16_t i = 2000;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// ComIrqReg[7..0] bits are: Set1 TxIRq RxIRq IdleIRq HiAlertIRq LoAlertIRq ErrIRq TimerIRq</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    n = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33adaea6b5804a6d640dbff5105949f5404">PCD_REG_ComIrqReg</a>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">// One of the interrupts that signal success has been set.</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> (n &amp; waitIrq)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// Timer interrupt - nothing received in 25ms</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (n &amp; 0x01)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386">MFRC522_STATUS_TIMEOUT</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// The emergency break. If all other condions fail we will eventually terminate on this one after 35.7ms.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">// Communication with the MFRC522 might be down.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span> (--i == 0)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386">MFRC522_STATUS_TIMEOUT</a>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// Stop now if any errors except collisions were detected.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">// ErrorReg[7..0] bits are: WrErr TempErr reserved BufferOvfl CollErr CRCErr ParityErr ProtocolErr</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  uint8_t errorRegValue = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a616cf0f1c0e035e8336b0f20617e7804">PCD_REG_ErrorReg</a>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">if</span> (errorRegValue &amp; 0x13)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">// BufferOvfl ParityErr ProtocolErr</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// If the caller wants data back, get it from the MFRC522.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordflow">if</span> (backData != NULL &amp;&amp; backLen != NULL)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment">// Number of bytes in the FIFO</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    n = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">PCD_REG_FIFOLevelReg</a>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span> (n &gt; *backLen)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afd52fd20b34b011fbec8d5062a0f87e1">MFRC522_STATUS_NO_ROOM</a>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// Number of bytes returned</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    *backLen = n;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">// Get received data from FIFO</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <a class="code" href="_m_f_r_c522__core_8h.html#a42cba06e7ef4cfa9afba588d7273e674">MFRC522_PCD_ReadRegisterArray</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a>, n, backData, rxAlign);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">// RxLastBits[2:0] indicates the number of valid bits in the last received byte. If this value is 000b, the whole byte is valid.</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    _validBits = <a class="code" href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0f45f3bb94d961288e224e6262f36ee0">PCD_REG_ControlReg</a>) &amp; 0x07;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span> (validBits != NULL)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      *validBits = _validBits;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">// Tell about collisions</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (errorRegValue &amp; 0x08)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  {</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">// CollErr</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a66c6e7b431d9c23df53dde3b31c44ab5">MFRC522_STATUS_COLLISION</a>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  }</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">// Perform CRC_A validation if requested.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">if</span> (backData != NULL &amp;&amp; backLen != NULL &amp;&amp; checkCRC != 0)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">// In this case a MIFARE Classic NAK is not OK.</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (*backLen == 1 &amp;&amp; _validBits == 4)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a627fb17aba855e860a82e8b7300f7e94">MFRC522_STATUS_MIFARE_NACK</a>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">// We need at least the CRC_A value and all 8 bits of the last byte must be received.</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (*backLen &lt; 2 || _validBits != 0)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a1614845f5f84e683c97e84aed6dfd255">MFRC522_STATUS_CRC_WRONG</a>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Verify CRC_A - do our own calculation and store the control in controlBuffer.</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    uint16_t controlBuffer;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    n = <a class="code" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a>(&amp;backData[0], *backLen - 2, &amp;controlBuffer);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (n != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">if</span> (   (backData[*backLen - 2] != ((controlBuffer &amp; 0xFF00) &gt;&gt; 8))</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        || (backData[*backLen - 1] != (controlBuffer &amp; 0xFF)))</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a1614845f5f84e683c97e84aed6dfd255">MFRC522_STATUS_CRC_WRONG</a>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">  724</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a>(uint8_t * sendData, uint8_t sendLen, uint8_t * backData,</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  uint8_t * backLen, uint8_t * validBits, uint8_t rxAlign, uint8_t checkCRC)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;{</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">// RxIRq and IdleIRq</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  uint8_t waitIRq = 0x30;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a5f030b32e2182ae7b70398bf5f38095b">MFRC522_PCD_CommunicateWithPICC</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17">PCD_CMD_Transceive</a>, waitIRq, sendData, sendLen, backData, backLen, validBits, rxAlign, checkCRC);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;}</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#afc8a5afccee76df36d3ed3f8348fefb8">  748</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#afc8a5afccee76df36d3ed3f8348fefb8">MFRC522_PICC_REQA_or_WUPA</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500ac">PICC_CMD</a> command, <a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a> * uid)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;{</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  uint8_t validBits;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> status;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  uint8_t bufferSize = <span class="keyword">sizeof</span>(uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#aa40e597ecb1bc0921f029f6f6653fb17">atqa</a>);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="comment">// ValuesAfterColl=1 =&gt; Suppression de tous les bits reçu après une collision</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a9400548ad6bc1533ae1759ab5633f31e">PCD_REG_CollReg</a>, 0x80);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="comment">// For REQA and WUPA we need the short frame format - transmit only 7 bits of the last (and only) byte. TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  validBits = 7;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  status = <a class="code" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a>(&amp;command, 1, (uint8_t *)&amp;uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#aa40e597ecb1bc0921f029f6f6653fb17">atqa</a>, &amp;bufferSize, &amp;validBits, 0, 0);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordflow">if</span> (status != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">if</span> (bufferSize != 2 || validBits != 0)</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="comment">// ATQA must be exactly 16 bits.</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;}</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a41b8c36b24ba229cc192a792caac62d0">  774</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a41b8c36b24ba229cc192a792caac62d0">MFRC522_PICC_RequestA</a>(<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a> * uid)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;{</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#afc8a5afccee76df36d3ed3f8348fefb8">MFRC522_PICC_REQA_or_WUPA</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad213da8df255bc6ff7cca5b7a28da7b4">PICC_CMD_REQA</a>, uid);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#ab7604f9c7275cd561647f60c6c8458b4">  779</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#ab7604f9c7275cd561647f60c6c8458b4">MFRC522_PICC_WakeupA</a>(<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a> * uid)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;{</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#afc8a5afccee76df36d3ed3f8348fefb8">MFRC522_PICC_REQA_or_WUPA</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95cc086aa9fc83fe999b43f6c508ff19">PICC_CMD_WUPA</a>, uid);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;}</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00784"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#ac23dafc7582c3002cb52d0389a41c1ec">  784</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#ac23dafc7582c3002cb52d0389a41c1ec">MFRC522_PICC_Select</a>(<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a> * uid)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;{</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="comment">// Pour le debug</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="comment">//char string[60];</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="comment">// Description de la structure du buffer :</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="comment">//    Byte 0: SEL                       Indicates the Cascade Level: PICC_CMD_SEL_CL1, PICC_CMD_SEL_CL2 or PICC_CMD_SEL_CL3</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="comment">//    Byte 1: NVB                       Number of Valid Bits (in complete command, not just the UID): High nibble: complete bytes, Low nibble: Extra bits. CRC non compté</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="comment">//    Byte 2: UID-data or CT    See explanation below. CT means Cascade Tag.</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">//    Byte 3: UID-data</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="comment">//    Byte 4: UID-data</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">//    Byte 5: UID-data</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">//    Byte 6: BCC               Block Check Character - XOR of bytes 2-5</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">//    Byte 7: CRC_A</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">//    Byte 8: CRC_A</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">// The BCC and CRC_A is only transmitted if we know all the UID bits of the current Cascade Level.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="comment">// Description of bytes 2-5: (Section 6.5.4 of the ISO/IEC 14443-3 draft: UID contents and cascade levels)</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="comment">//    UID size  Cascade level Byte2 Byte3 Byte4 Byte5</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">//    ========  ============= ===== ===== ===== =====</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="comment">//     4 bytes              1  uid0  uid1  uid2  uid3</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="comment">//     7 bytes              1    CT  uid0  uid1  uid2</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">//                          2  uid3  uid4  uid5  uid6</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">//    10 bytes              1    CT  uid0  uid1  uid2</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">//                          2    CT  uid3  uid4  uid5</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="comment">//                          3  uid6  uid7  uid8  uid9</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  uint8_t buffer[9];</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> result;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  uint8_t rxAlign;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  uint8_t txLastBits;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  uint8_t responseBuffer[10];    <span class="comment">// La réponse à un cascade level est l&#39;UID complet (10 octets max)</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  uint8_t responseLength;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="comment">// On vérifie que le PICC ou le TAG dispose bien d&#39;une bit frame anticollision (Cf. 6.4.1 ISO/IEC 14443-3)</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  uint8_t bit_frame_anticollision = uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#aa40e597ecb1bc0921f029f6f6653fb17">atqa</a> &amp; 0x001F;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">if</span> (   bit_frame_anticollision != 0x01</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      &amp;&amp; bit_frame_anticollision != 0x02</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      &amp;&amp; bit_frame_anticollision != 0x04</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      &amp;&amp; bit_frame_anticollision != 0x08</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      &amp;&amp; bit_frame_anticollision != 0x10</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;     )</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a34fca9ae70a2078ae9aa791acb68f5b6">MFRC522_STATUS_PROPRIETARY_ANTICOLLISION</a>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;   <span class="comment">// ValuesAfterColl=1 =&gt; Suppression de tous les bits reçu après une collision</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   <a class="code" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a9400548ad6bc1533ae1759ab5633f31e">PCD_REG_CollReg</a>, 0x80);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="comment">// Cascade level 1</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="comment">//USART_SendString(&quot;Cascade 1\n&quot;);</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// octet 1 : Cascade level 1</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  buffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca6cd44287b13b4ac175b38bde5ef61f5b">PICC_CMD_SEL_CL1</a>;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">// octet 2 : High nibble =&gt; 2 octets plein, Low nibble =&gt; Pas d&#39;extra bits</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  buffer[1] = 0x20;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">// 0 =&gt; Tous les octets sont plein</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  txLastBits = 0x00;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  rxAlign = 0x00;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  responseLength = 10;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a>(buffer, 2, responseBuffer, &amp;responseLength, &amp;txLastBits, rxAlign, 0);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordflow">if</span> (result == <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a66c6e7b431d9c23df53dde3b31c44ab5">MFRC522_STATUS_COLLISION</a>)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">  USART_SendString(&quot;Buffer =&quot;);</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">  for (uint8_t i = 0; i &lt; responseLength; i++)</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment">  {</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">    USART_SendString(&quot; 0x&quot;);</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">    itoa(responseBuffer[i], string, 16);</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">    USART_SendString(string);</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">  }</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">  USART_SendString(&quot;\n&quot;);</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="comment">// Vérification du retour =&gt; 4 octets de l&#39;UID + 1 octet BCC</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">if</span> (   responseLength != 5</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      || txLastBits != 0)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    uint8_t bcc = responseBuffer[0] ^ responseBuffer[1] ^ responseBuffer[2] ^ responseBuffer[3];</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> (bcc != responseBuffer[4])</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a8b7b2abc49823383fc4ac7cf89709007">MFRC522_STATUS_BCC_ERROR</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#ac540a995e737d0311f158bbf1814b2b6">uid</a>[0] = responseBuffer[0];</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#ac540a995e737d0311f158bbf1814b2b6">uid</a>[1] = responseBuffer[1];</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#ac540a995e737d0311f158bbf1814b2b6">uid</a>[2] = responseBuffer[2];</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#ac540a995e737d0311f158bbf1814b2b6">uid</a>[3] = responseBuffer[3];</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#aff9ecf1799e6a1b0c8e67c77b50063ad">uidsize</a> = 4;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="comment">// Sélection de la carte</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="comment">// octet 1 : Cascade level 1</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  buffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca6cd44287b13b4ac175b38bde5ef61f5b">PICC_CMD_SEL_CL1</a>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">// octet 2 : High nibble =&gt; 7 octets plein, Low nibble =&gt; Pas d&#39;extra bits</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  buffer[1] = 0x70;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// octets 3 à 6 : 4 octets de l&#39;UID à sélectionner</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  buffer[2] = responseBuffer[0];</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  buffer[3] = responseBuffer[1];</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  buffer[4] = responseBuffer[2];</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  buffer[5] = responseBuffer[3];</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="comment">// BCC - Block Check Character</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  buffer[6] = responseBuffer[4];</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="comment">// CRC_A</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  uint16_t crc = 0x0000;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a>(buffer, 7, &amp;crc);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  buffer[7] = (crc &amp; 0xFF00) &gt;&gt; 8;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  buffer[8] = crc &amp; 0x00FF;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// 0 =&gt; Tous les octets sont plein</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  txLastBits = 0x00;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  rxAlign = 0x00;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  responseLength = 10;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a>(buffer, 9, responseBuffer, &amp;responseLength, &amp;txLastBits, rxAlign, 1);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">// A ce stade nous devons avoir une réponse SAK (Select Acknowledge) =&gt; 1 octet + CRC_A</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordflow">if</span> (   responseLength != 3</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      || txLastBits != 0)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">if</span> (responseBuffer[0] &amp; 0x04)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">//USART_SendString(&quot;Need more...\n&quot;);</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment"></span>    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a9cfb9908f0583d4cfb7b789511c61e67">MFRC522_STATUS_INTERNAL_ERROR</a>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#a57246842b6fa5978594cb58f9f4d8df7">sak</a> = responseBuffer[0];</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">  uint8_t useCascadeTag = 0;</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">  uint8_t cascadeLevel = 1;</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">  MFRC522_STATUS result;</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">  uint8_t count;</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">  uint8_t index;</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">  uint8_t uidIndex;                 // The first index in uid-&gt;uidByte[] that is used in the current Cascade Level.</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">    int8_t currentLevelKnownBits;     // The number of known UID bits in the current Cascade Level.</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">  uint8_t buffer[9];                // The SELECT/ANTICOLLISION commands uses a 7 byte standard frame + 2 bytes CRC_A</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">  uint8_t bufferUsed;               // The number of bytes used in the buffer, ie the number of bytes to transfer to the FIFO.</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">  uint8_t rxAlign;                  // Used in BitFramingReg. Defines the bit position for the first bit received.</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">  uint8_t txLastBits;               // Used in BitFramingReg. The number of valid bits in the last transmitted byte.</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">  uint8_t *responseBuffer;</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">  uint8_t responseLength;</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">    // Sanity checks</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">    if (validBits &gt; 80)</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">  {</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">        return MFRC522_STATUS_INVALID;</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">    // Préparation du MFRC522</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">  // ValuesAfterColl=1 =&gt; Bits received after collision are cleared.</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">  MFRC522_PCD_ClearRegisterBitMask(PCD_REG_CollReg, 0x80);</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">    // On cycle sur les cascade levels tant que l&#39;on a pas un UID complet</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">  uint8_t uidComplete = 0;</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">    while (uidComplete == 0)</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">  {</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">        // Set the Cascade Level in the SEL byte, find out if we need to use the Cascade Tag in byte 2.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">        switch (cascadeLevel)</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">            case 1:</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">      USART_SendString(&quot;Cascade 1\n&quot;);</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">                buffer[0] = PICC_CMD_SEL_CL1;</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">                uidIndex = 0;</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">        // When we know that the UID has more than 4 bytes</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">                useCascadeTag = (validBits &amp;&amp; uid-&gt;size &gt; 4) ? 1 : 0;</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">            case 2:</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">      USART_SendString(&quot;Cascade 2\n&quot;);</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">                buffer[0] = PICC_CMD_SEL_CL2;</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">                uidIndex = 3;</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">        // When we know that the UID has more than 7 bytes</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">                useCascadeTag = (validBits &amp;&amp; uid-&gt;size &gt; 7) ? 1 : 0;</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">            case 3:</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">      USART_SendString(&quot;Cascade 3\n&quot;);</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">                buffer[0] = PICC_CMD_SEL_CL3;</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">                uidIndex = 6;</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">        // Never used in CL3.</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">                useCascadeTag = 0;</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">            default:</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">                return MFRC522_STATUS_INTERNAL_ERROR;</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">        // How many UID bits are known in this Cascade Level?</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">        currentLevelKnownBits = validBits - (8 * uidIndex);</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">        if (currentLevelKnownBits &lt; 0)</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">            currentLevelKnownBits = 0;</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">        // Copy the known bits from uid-&gt;uidByte[] to buffer[]</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">    // destination index in buffer[]</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">        index = 2;</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">        if (useCascadeTag != 0)</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">            buffer[index++] = PICC_CMD_CT;</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">    // The number of bytes needed to represent the known bits for this level.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">        uint8_t bytesToCopy = currentLevelKnownBits / 8 + (currentLevelKnownBits % 8 ? 1 : 0);</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">        if (bytesToCopy != 0)</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">      // Max 4 bytes in each Cascade Level. Only 3 left if we use the Cascade Tag</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">      uint8_t maxBytes = (useCascadeTag != 0) ? 3 : 4;</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">            if (bytesToCopy &gt; maxBytes)</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">                bytesToCopy = maxBytes;</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">            for (count = 0; count &lt; bytesToCopy; count++)</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">                buffer[index++] = uid-&gt;uid[uidIndex + count];</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">        // Now that the data has been copied we need to include the 8 bits in CT in currentLevelKnownBits</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">        if (useCascadeTag != 0)</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">            currentLevelKnownBits += 8;</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">        // Repeat anti collision loop until we can transmit all UID bits + BCC and receive a SAK - max 32 iterations.</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">    uint8_t selectDone = 0;</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">        while (selectDone == 0)</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">    USART_SendString(&quot;  currentLevelKnownBits=&quot;);</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">    char b[60];</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">    itoa(currentLevelKnownBits, b, 16);</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">    USART_SendString(b);</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">    USART_SendString(&quot;\n&quot;);</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">            // Find out how many bits and bytes to send and receive.</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">            if (currentLevelKnownBits &gt;= 32)</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">        // All UID bits in this Cascade Level are known. This is a SELECT.</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">        // NVB - Number of Valid Bits: Seven whole bytes</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">                buffer[1] = 0x70;</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">                // Calculate BCC - Block Check Character</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">                buffer[6] = buffer[2] ^ buffer[3] ^ buffer[4] ^ buffer[5];</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">                // Calculate CRC_A</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">                result = MFRC522_PCD_CalculateCRC(buffer, 7, &amp;buffer[7]);</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">                if (result != MFRC522_STATUS_OK)</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">                    return result;</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">        // 0 =&gt; All 8 bits are valid.</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">                txLastBits = 0;</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">                bufferUsed = 9;</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">                // Store response in the last 3 bytes of buffer (BCC and CRC_A - not needed after tx)</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">                responseBuffer = &amp;buffer[6];</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">                responseLength = 3;</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">            else</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">        // This is an ANTICOLLISION.</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">                txLastBits = currentLevelKnownBits % 8;</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">        // Number of whole bytes in the UID part.</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">                count = currentLevelKnownBits / 8;</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">        // Number of whole bytes: SEL + NVB + UIDs</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">                index = 2 + count;</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">        // NVB - Number of Valid Bits</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">                buffer[1] = (index &lt;&lt; 4) + txLastBits;</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">                bufferUsed = index + ((txLastBits != 0) ? 1 : 0);</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">                // Store response in the unused part of buffer</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">                responseBuffer = &amp;buffer[index];</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">                responseLength = sizeof(buffer) - index;</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">            // Set bit adjustments</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">      // Having a seperate variable is overkill. But it makes the next line easier to read.</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">            rxAlign = txLastBits;</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">      // RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">            MFRC522_PCD_WriteRegister(PCD_REG_BitFramingReg, (rxAlign &lt;&lt; 4) + txLastBits);</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">            // Transmit the buffer and receive the response.</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">      USART_SendString(&quot;Tranceive...\n&quot;);</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">            result = MFRC522_PCD_TransceiveData(buffer, bufferUsed, responseBuffer, &amp;responseLength, &amp;txLastBits, rxAlign, 0);</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">            if (result == MFRC522_STATUS_COLLISION)</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">      USART_SendString(&quot;Collision !\n&quot;);</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">        // More than one PICC in the field =&gt; collision.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">        // CollReg[7..0] bits are: ValuesAfterColl reserved CollPosNotValid CollPos[4:0]</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">                result = MFRC522_PCD_ReadRegister(PCD_REG_CollReg);</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">                if (result &amp; 0x20)</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">        USART_SendString(&quot;Collision vérifiée\n&quot;);</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">          // CollPosNotValid</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">          // Without a valid collision position we cannot continue</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">                    return MFRC522_STATUS_COLLISION;</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">        // Values 0-31, 0 means bit 32.</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">                uint8_t collisionPos = result &amp; 0x1F;</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">                if (collisionPos == 0)</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">                    collisionPos = 32;</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">                if (collisionPos &lt;= currentLevelKnownBits)</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">          // No progress - should not happen</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">                    return MFRC522_STATUS_INTERNAL_ERROR;</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">                // Choose the PICC with the bit set.</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">                currentLevelKnownBits = collisionPos;</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">        // The bit to modify</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">                count = (currentLevelKnownBits - 1) % 8;</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">        // First byte is index 0.</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">                index = 1 + (currentLevelKnownBits / 8) + ((count != 0) ? 1 : 0);</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">                buffer[index]   |= (1 &lt;&lt; count);</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">            else</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">        if (result != MFRC522_STATUS_OK)</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">        USART_SendString(&quot;  currentLevelKnownBits 2=&quot;);</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">        itoa(currentLevelKnownBits, b, 16);</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">        USART_SendString(b);</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">        USART_SendString(&quot;\n&quot;);</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">                return result;</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">        // STATUS_OK</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">                if (currentLevelKnownBits &gt;= 32)</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">          USART_SendString(&quot;Select done\n&quot;);</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">          // This was a SELECT.</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">          // No more anticollision</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">                    selectDone = 1;</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">                    // We continue below outside the while.</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">                else</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">          USART_SendString(&quot;ANTICOLLISION\n&quot;);</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">          // This was an ANTICOLLISION.</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">                    // We now have all 32 bits of the UID in this Cascade Level</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">                    currentLevelKnownBits = 32;</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">                    // Run loop again to do the SELECT.</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">      USART_SendString(&quot;T OK !...\n&quot;);</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">        } // End of while (selectDone == 0)</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">    USART_SendString(&quot;Fin whiel\n&quot;);</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">        // We do not check the CBB - it was constructed by us above.</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">        // Copy the found UID bytes from buffer[] to uid-&gt;uidByte[]</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">    // source index in buffer[]</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">        index = (buffer[2] == PICC_CMD_CT) ? 3 : 2;</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">        bytesToCopy = (buffer[2] == PICC_CMD_CT) ? 3 : 4;</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">        for (count = 0; count &lt; bytesToCopy; count++)</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">            uid-&gt;uid[uidIndex + count] = buffer[index++];</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">        // Check response SAK (Select Acknowledge)</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">        if (responseLength != 3 || txLastBits != 0)</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">      // SAK must be exactly 24 bits (1 byte + CRC_A).</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">            return MFRC522_STATUS_ERROR;</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">        // Verify CRC_A - do our own calculation and store the control in buffer[2..3] - those bytes are not needed anymore.</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">    USART_SendString(&quot;CRC N°2...\n&quot;);</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">        result = MFRC522_PCD_CalculateCRC(responseBuffer, 1, &amp;buffer[2]);</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">        if (result != MFRC522_STATUS_OK)</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">            return result;</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">    USART_SendString(&quot;OK !...\n&quot;);</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">        if ((buffer[2] != responseBuffer[1]) || (buffer[3] != responseBuffer[2]))</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">            return MFRC522_STATUS_CRC_WRONG;</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">        if (responseBuffer[0] &amp; 0x04)</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">      // Cascade bit set - UID not complete yes</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">            cascadeLevel++;</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">        else</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">            uidComplete = 1;</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">            uid-&gt;sak = responseBuffer[0];</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment">    } // End of while (uidComplete == 0)</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">    // Set correct uid-&gt;size</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment">    uid-&gt;size = 3 * cascadeLevel + 1;</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">    return MFRC522_STATUS_OK;</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;}</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a2820fbfc5839e179d9fab1192490d91e"> 1227</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a2820fbfc5839e179d9fab1192490d91e">MFRC522_PICC_HaltA</a>()</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;{</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> result;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  uint8_t buffer[4];</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="comment">// Construction du buffer pour la commande</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  buffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca881588d3cca42490c71666c97b55a6c8">PICC_CMD_HLTA</a>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  buffer[1] = 0x00;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">// Calcule du CRC_A</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  uint16_t crc = 0x0000;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a>(buffer, 2, &amp;crc);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  {</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  buffer[2] = (crc &amp; 0xFF00) &gt;&gt; 8;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  buffer[3] = crc &amp; 0x00FF;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">// Envoi de la commande</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">// Le standard dit :</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">//    Si le PICC répond sans modulation durant une période de 1ms après la din de la frame contenant la commande</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">//    HALT, sa réponse devrait être interprétée comme &quot;non acquité&quot;.</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="comment">// L&#39;interprétation faite ici : Seul un timeout est un succès</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a>(buffer, 4, NULL, NULL, NULL, 0, 0);</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keywordflow">if</span> (result == <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386">MFRC522_STATUS_TIMEOUT</a>)</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  }</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordflow">if</span> (result == <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  {</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  }</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;}</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035"> 1281</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>(uint8_t * sendData, uint8_t sendLen, uint8_t acceptTimeout)</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;{</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> result;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">// Le buffer fera 16 octets maximum + 2 octets de CRC_A</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  uint8_t buffer[18];</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">// Préparation du buffer</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; sendLen; i++)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    buffer[i] = sendData[i];</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  }</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  uint16_t crc = 0x0000;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a>(buffer, sendLen, &amp;crc);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  buffer[sendLen++]     = (crc &amp; 0xFF00) &gt;&gt; 8;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  buffer[sendLen++] = crc &amp; 0x00FF;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <span class="comment">// Envoi des données et récupération du résultat dans buffer</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="comment">// RxIRq and IdleIRq</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  uint8_t waitIRq = 0x30;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  uint8_t bufferSize = 18;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  uint8_t validBits = 0;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#a5f030b32e2182ae7b70398bf5f38095b">MFRC522_PCD_CommunicateWithPICC</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17">PCD_CMD_Transceive</a>, waitIRq, buffer, sendLen, buffer, &amp;bufferSize, &amp;validBits, 0, 0);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keywordflow">if</span> (acceptTimeout &amp;&amp; result == <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386">MFRC522_STATUS_TIMEOUT</a>)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  }</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  }</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="comment">// Le PICC doit répondre un ACK sur 4bits (MF_ACK)</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordflow">if</span> (bufferSize != 1 || validBits != 4)</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  {</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="keywordflow">if</span> (buffer[0] != <a class="code" href="_m_f_r_c522__core_8h.html#a39edefa4be0db73b639644f19aa79bbc">MFRC522_MIFARE_ACK</a>)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a627fb17aba855e860a82e8b7300f7e94">MFRC522_STATUS_MIFARE_NACK</a>;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div>
<div class="line"><a name="l01341"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a096082dcc584f4e93f45a58206363a8c"> 1341</a></span>&#160; <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a096082dcc584f4e93f45a58206363a8c">MFRC522_MIFARE_TwoStepHelper</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500ac">PICC_CMD</a> command, uint8_t blockAddr, int32_t data)</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> result;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   uint8_t buffer[2];</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="comment">// Etape 1 : Envoi de la commande et de l&#39;adresse du block</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  buffer[0] = command;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  buffer[1] = blockAddr;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    result = <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>(buffer, 2, 0);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">// Etape 2 : Envoi des données</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    result = <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>((uint8_t *)&amp;data, 4, 1);  <span class="comment">// Un timeout est un succès</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  {</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;}</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div>
<div class="line"><a name="l01365"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aa1ba0ad4f22036448751f56d80a63b59"> 1365</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#aa1ba0ad4f22036448751f56d80a63b59">MFRC522_MIFARE_Authenticate</a>(<a class="code" href="_m_f_r_c522_8h.html#a89adaf1e8ac46b6d0c7bb83c58d152d4">MFRC522_AUTH_KEY</a> keytype, uint8_t blockAddr, <a class="code" href="struct_m_f_r_c522___m_i_f_a_r_e___k_e_y.html">MFRC522_MIFARE_KEY</a> * key, <a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a> * uid)</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;{</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="comment">// IdleIRq</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  uint8_t waitIRq = 0x10;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  uint8_t sendData[2 + <a class="code" href="_m_f_r_c522_8h.html#ae08583699989a52ba709c10416da4049">MFRC522_AUTH_KEY_SIZE</a> + 4];</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  uint8_t sendLen = 2 + <a class="code" href="_m_f_r_c522_8h.html#ae08583699989a52ba709c10416da4049">MFRC522_AUTH_KEY_SIZE</a> + 4;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="keywordflow">switch</span> (keytype)</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="_m_f_r_c522_8h.html#a89adaf1e8ac46b6d0c7bb83c58d152d4a1050aafc23ebab8d7c32a82fdfdaf954">MFRC522_AUTH_KEY_A</a>:</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      sendData[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaed599c1a5ba157455ed438315406c305">PICC_CMD_MF_AUTH_KEY_A</a>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="_m_f_r_c522_8h.html#a89adaf1e8ac46b6d0c7bb83c58d152d4af338d6034d98313cb5f2b2ce58f8e8cd">MFRC522_AUTH_KEY_B</a>:</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      sendData[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95ad7ce4f4272886b6756b49f3aeaf9a">PICC_CMD_MF_AUTH_KEY_B</a>;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a9cfb9908f0583d4cfb7b789511c61e67">MFRC522_STATUS_INTERNAL_ERROR</a>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  }</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  sendData[1] = blockAddr;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="_m_f_r_c522_8h.html#ae08583699989a52ba709c10416da4049">MFRC522_AUTH_KEY_SIZE</a>; i++)</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  {</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    sendData[2 + i] = key-&gt;<a class="code" href="struct_m_f_r_c522___m_i_f_a_r_e___k_e_y.html#aa5796eb2b87658109033917343626e5d">keybyte</a>[i];</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 4; i++)</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    sendData[2 + MFRC522_AUTH_KEY_SIZE + i] = uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#ac540a995e737d0311f158bbf1814b2b6">uid</a>[i];</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  }</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a5f030b32e2182ae7b70398bf5f38095b">MFRC522_PCD_CommunicateWithPICC</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a9f1455eb011b595fce71f1c334c3452b">PCD_CMD_MFAuthent</a>, waitIRq, sendData, sendLen, NULL, NULL, NULL, 0, 0);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;}</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div>
<div class="line"><a name="l01396"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a27c4dca79d3f27e6014245370f88156a"> 1396</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a27c4dca79d3f27e6014245370f88156a">MFRC522_MIFARE_StopCrypto1</a>()</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;{</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="comment">// Status2Reg[7..0] bits are: TempSensClear I2CForceHS reserved reserved MFCrypto1On ModemState[2:0]</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <a class="code" href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a>(<a class="code" href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a8d6496f8cf42e6dcb95019637816fec4">PCD_REG_Status2Reg</a>, 0x08);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;}</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div>
<div class="line"><a name="l01402"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#afc38269694aaca1081f9327559411724"> 1402</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#afc38269694aaca1081f9327559411724">MFRC522_MIFARE_Read</a>(uint8_t blockAddr, uint8_t * buffer, uint8_t * bufferSize)</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;{</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> result;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="comment">// Construction du buffer</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  buffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad2cedf2b5b620a6d874f0b8360e7e36c">PICC_CMD_MF_READ</a>;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  buffer[1] = blockAddr;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="comment">// Calcule du CRC_A</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  uint16_t crc = 0x0000;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a>(buffer, 2, &amp;crc);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  }</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  buffer[2] = (crc &amp; 0xFF00) &gt;&gt; 8;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  buffer[3] = crc &amp; 0x00FF;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a>(buffer, 4, buffer, bufferSize, NULL, 0, 1);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;}</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div>
<div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#af652f395989dbce8064a5679115fa9cf"> 1422</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#af652f395989dbce8064a5679115fa9cf">MFRC522_MIFARE_Write</a>(uint8_t blockAddr, uint8_t * buffer, uint8_t bufferSize)</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;{</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> result;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  <span class="comment">// Le protocole MIFARE impose d&#39;avoir deux étapes de communications</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="comment">// Etape 1 : Indique au PICC que l&#39;on désire écrire</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  uint8_t cmdBuffer[2];</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  cmdBuffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab328a35286d092e483fa370d1868e44e">PICC_CMD_MF_WRITE</a>;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  cmdBuffer[1] = blockAddr;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>(cmdBuffer, 2, 0);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="comment">// Etape 2: Transfert des données</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  result = <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>(buffer, bufferSize, 0);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="keywordflow">if</span> (result != <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;}</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div>
<div class="line"><a name="l01447"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#ad060eed5c2f314197b59d052572aab14"> 1447</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#ad060eed5c2f314197b59d052572aab14">MFRC522_MIFARE_Decrement</a>(uint8_t blockAddr, int32_t delta)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;{</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a096082dcc584f4e93f45a58206363a8c">MFRC522_MIFARE_TwoStepHelper</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0329cc76c269606689b6c3b35683136c">PICC_CMD_MF_DECREMENT</a>, blockAddr, delta);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;}</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a69b49dba203b00abdb4ad357b6ca525e"> 1452</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a69b49dba203b00abdb4ad357b6ca525e">MFRC522_MIFARE_Increment</a>(uint8_t blockAddr, int32_t delta)</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;{</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a096082dcc584f4e93f45a58206363a8c">MFRC522_MIFARE_TwoStepHelper</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0a14c55a640535db5c46ce0110df7a44">PICC_CMD_MF_INCREMENT</a>, blockAddr, delta);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;}</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div>
<div class="line"><a name="l01457"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a11ee075ea907230de403411986876ad5"> 1457</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a11ee075ea907230de403411986876ad5">MFRC522_MIFARE_Restore</a>(uint8_t blockAddr)</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;{</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a096082dcc584f4e93f45a58206363a8c">MFRC522_MIFARE_TwoStepHelper</a>(<a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaebf925b876166923f98130644349e6ec">PICC_CMD_MF_RESTORE</a>, blockAddr, 0);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;}</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div>
<div class="line"><a name="l01462"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a5367c43aa316d6c7509af27a451b7e8b"> 1462</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a5367c43aa316d6c7509af27a451b7e8b">MFRC522_MIFARE_Transfer</a>(uint8_t blockAddr)</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;{</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  uint8_t buffer[2];</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  buffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca8985fa08e3634abc0229923901e5bd97">PICC_CMD_MF_TRANSFER</a>;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  buffer[1] = blockAddr;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>(buffer, 2, 0);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;}</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a265b17588bdc955f9efb93719b52895b"> 1471</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#a265b17588bdc955f9efb93719b52895b">MFRC522_MIFARE_Ultralight_Write</a>(uint8_t page, uint8_t * buffer, uint8_t bufferSize)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;{</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  uint8_t cmdBuffer[6];</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  cmdBuffer[0] = <a class="code" href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca09929cac708d474115bdcb25f3d61f81">PICC_CMD_UL_WRITE</a>;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  cmdBuffer[1] = page;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 4; i++)</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    cmdBuffer[2 + i] = buffer[i];</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  }</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a>(cmdBuffer, 6, 0);</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;}</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div>
<div class="line"><a name="l01484"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#acd5263773974b6a152486da112de524f"> 1484</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#acd5263773974b6a152486da112de524f">MFRC522_MIFARE_Classic_GetValue</a>(uint8_t blockAddr, int32_t * value)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;{</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> status;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    uint8_t buffer[18];</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  uint8_t size = 18;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    status = <a class="code" href="_m_f_r_c522__core_8h.html#afc38269694aaca1081f9327559411724">MFRC522_MIFARE_Read</a>(blockAddr, buffer, &amp;size);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">if</span> (status == <a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a>)</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  {</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        *value = ((int32_t)(buffer[3]) &lt;&lt; 24) |</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;             ((int32_t)(buffer[2]) &lt;&lt; 16) |</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;             ((int32_t)(buffer[1]) &lt;&lt;  8) |</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;             (int32_t)(buffer[0]);</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    }</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;}</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div>
<div class="line"><a name="l01502"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#af697ac5719bd10495d99085f5e9dca45"> 1502</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a> <a class="code" href="_m_f_r_c522__core_8h.html#af697ac5719bd10495d99085f5e9dca45">MFRC522_MIFARE_Classic_SetValue</a>(uint8_t blockAddr, int32_t value)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;{</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  uint8_t buffer[18];</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="comment">// Transformation de l&#39;entier sur 4 octets. Répété 2 fois dans le block.</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  buffer[0] = buffer[ 8] = (value &amp; 0xFF);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  buffer[1] = buffer[ 9] = (value &amp; 0xFF00) &gt;&gt; 8;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  buffer[2] = buffer[10] = (value &amp; 0xFF0000) &gt;&gt; 16;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  buffer[3] = buffer[11] = (value &amp; 0xFF000000) &gt;&gt; 24;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="comment">// On inverse les 4 octets de la valeur au bon endroit dans le bloc.</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  buffer[4] = ~buffer[0];</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  buffer[5] = ~buffer[1];</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  buffer[6] = ~buffer[2];</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  buffer[7] = ~buffer[3];</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <span class="comment">// Ecriture de l&#39;adresse 2 fois et en mode inversé</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  buffer[12] = buffer[14] = blockAddr;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  buffer[13] = buffer[15] = ~blockAddr;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="comment">// Ecriture de l&#39;ensemble du block</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522__core_8h.html#af652f395989dbce8064a5679115fa9cf">MFRC522_MIFARE_Write</a>(blockAddr, buffer, 16);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;}</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#aff7ee2a68796dbf4d5f1d8433d41b083"> 1524</a></span>&#160;<a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6e">MFRC522_PICC_TYPE</a> <a class="code" href="_m_f_r_c522__core_8h.html#aff7ee2a68796dbf4d5f1d8433d41b083">MFRC522_PICC_GetType</a>(<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a> * uid)</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;{</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="keywordflow">if</span> (uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#a57246842b6fa5978594cb58f9f4d8df7">sak</a> &amp; 0x04)</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  {</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="comment">// UID incomplet</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eada76c526ba87176f4f628d82dc4434cb">MFRC522_PICC_TYPE_NOT_COMPLETE</a>;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  }</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordflow">switch</span> (uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#a57246842b6fa5978594cb58f9f4d8df7">sak</a>)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  {</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">case</span> 0x00:</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea5bdab066171aabf26e4a51a6b6f82abc">MFRC522_PICC_TYPE_MIFARE_UL</a>;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">case</span> 0x01:</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea83f7ce6e4e57aacd2202e4f46cafb5d7">MFRC522_PICC_TYPE_TNP3XXX</a>;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordflow">case</span> 0x08:</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eaa0842ffe78c7eb0e3e50023ab8555206">MFRC522_PICC_TYPE_MIFARE_1K</a>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordflow">case</span> 0x09:</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea82440ae14051cfd6a163c44a368ceb37">MFRC522_PICC_TYPE_MIFARE_MINI</a>;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">case</span> 0x10:</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="keywordflow">case</span> 0x11:</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea7c1ca3a1d6007e3d8756683fbe9a2f29">MFRC522_PICC_TYPE_MIFARE_PLUS</a>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">case</span> 0x18:</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea66d516f2f32de4afb43216b5ccf86804">MFRC522_PICC_TYPE_MIFARE_4K</a>;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">case</span> 0x20:</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea7e9a94106c447f4bf2961d0c5fe5557b">MFRC522_PICC_TYPE_MIFARE_DESFIRE</a>;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">case</span> 0x28:</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea6b65c8717db71b024d2a7a123b32a74f">MFRC522_PICC_TYPE_JCOP30</a>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keywordflow">case</span> 0x38:</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eaf9380812869951aa2e681c405eb0c754">MFRC522_PICC_TYPE_MIFARE_4K_EMUL</a>;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">case</span> 0x88:</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea9e0213161362742f92643edce79d1e0a">MFRC522_PICC_TYPE_MIFARE_1K_INFINEON</a>;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">case</span> 0x98:</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eacda3341fc8f2e14b82d48fe3557e6859">MFRC522_PICC_TYPE_MPCOS</a>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordflow">if</span> (uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#a57246842b6fa5978594cb58f9f4d8df7">sak</a> &amp; 0x20)</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  {</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea54181fb39067b717ec991e8b7cee9b8c">MFRC522_PICC_TYPE_ISO_14443_4</a>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  }</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">if</span> (uid-&gt;<a class="code" href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#a57246842b6fa5978594cb58f9f4d8df7">sak</a> &amp; 0x40)</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eab17aa2fc84ed855b8f0739913068e5ad">MFRC522_PICC_TYPE_ISO_18092</a>;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  }</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea9c158029c33cf5f4af7e5500d4a1adc3">MFRC522_PICC_TYPE_UNKNOWN</a>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;}</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div>
<div class="line"><a name="l01585"></a><span class="lineno"><a class="line" href="_m_f_r_c522__core_8h.html#a7d00e13ef93354b5b523f7267b47fdf7"> 1585</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="_m_f_r_c522__core_8h.html#a7d00e13ef93354b5b523f7267b47fdf7">MFRC522_MIFARE_SetAccessBits</a>(uint8_t * accessBitBuffer, uint8_t g0, uint8_t g1, uint8_t g2, uint8_t g3)</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;{</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;  uint8_t c1 = ((g3 &amp; 4) &lt;&lt; 1) | ((g2 &amp; 4) &lt;&lt; 0) | ((g1 &amp; 4) &gt;&gt; 1) | ((g0 &amp; 4) &gt;&gt; 2);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  uint8_t c2 = ((g3 &amp; 2) &lt;&lt; 2) | ((g2 &amp; 2) &lt;&lt; 1) | ((g1 &amp; 2) &lt;&lt; 0) | ((g0 &amp; 2) &gt;&gt; 1);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  uint8_t c3 = ((g3 &amp; 1) &lt;&lt; 3) | ((g2 &amp; 1) &lt;&lt; 2) | ((g1 &amp; 1) &lt;&lt; 1) | ((g0 &amp; 1) &lt;&lt; 0);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    accessBitBuffer[0] = (~c2 &amp; 0xF) &lt;&lt; 4 | (~c1 &amp; 0xF);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    accessBitBuffer[1] =          c1 &lt;&lt; 4 | (~c3 &amp; 0xF);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    accessBitBuffer[2] =          c3 &lt;&lt; 4 | c2;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;}</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* _MFRC522_CORE_H_ */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">#define NR_KNOWN_KEYS   8</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">// Known keys, see: https://code.google.com/p/mfcuk/wiki/MifareClassicDefaultKeys</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">byte knownKeys[NR_KNOWN_KEYS][MFRC522::MF_KEY_SIZE] =  {</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff}, // FF FF FF FF FF FF = factory default</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">    {0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5}, // A0 A1 A2 A3 A4 A5</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">    {0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5}, // B0 B1 B2 B3 B4 B5</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">    {0x4d, 0x3a, 0x99, 0xc3, 0x51, 0xdd}, // 4D 3A 99 C3 51 DD</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">    {0x1a, 0x98, 0x2c, 0x7e, 0x45, 0x9a}, // 1A 98 2C 7E 45 9A</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">    {0xd3, 0xf7, 0xd3, 0xf7, 0xd3, 0xf7}, // D3 F7 D3 F7 D3 F7</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">    {0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff}, // AA BB CC DD EE FF</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}  // 00 00 00 00 00 00</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">};</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160; <span class="comment">/*</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">byte MFRC522::PICC_Select(  Uid *uid,           ///&lt; Pointer to Uid struct. Normally output, but can also be used to supply a known UID.</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">                            byte validBits      ///&lt; The number of known UID bits supplied in *uid. Normally 0. If set you must also supply uid-&gt;size.</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">                         ) {</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment">    bool uidComplete;</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment">    bool selectDone;</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">    bool useCascadeTag;</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">    byte cascadeLevel = 1;</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">    byte result;</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment">    byte count;</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="comment">    byte index;</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment">    byte uidIndex;                  // The first index in uid-&gt;uidByte[] that is used in the current Cascade Level.</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">    int8_t currentLevelKnownBits;       // The number of known UID bits in the current Cascade Level.</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">    byte buffer[9];                 // The SELECT/ANTICOLLISION commands uses a 7 byte standard frame + 2 bytes CRC_A</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment">    byte bufferUsed;                // The number of bytes used in the buffer, ie the number of bytes to transfer to the FIFO.</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">    byte rxAlign;                   // Used in BitFramingReg. Defines the bit position for the first bit received.</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">    byte txLastBits;                // Used in BitFramingReg. The number of valid bits in the last transmitted byte.</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">    byte *responseBuffer;</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment">    byte responseLength;</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment">    // Description of buffer structure:</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">    //      Byte 0: SEL                 Indicates the Cascade Level: PICC_CMD_SEL_CL1, PICC_CMD_SEL_CL2 or PICC_CMD_SEL_CL3</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment">    //      Byte 1: NVB                 Number of Valid Bits (in complete command, not just the UID): High nibble: complete bytes, Low nibble: Extra bits.</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">    //      Byte 2: UID-data or CT      See explanation below. CT means Cascade Tag.</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">    //      Byte 3: UID-data</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment">    //      Byte 4: UID-data</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment">    //      Byte 5: UID-data</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment">    //      Byte 6: BCC                 Block Check Character - XOR of bytes 2-5</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">    //      Byte 7: CRC_A</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">    //      Byte 8: CRC_A</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">    // The BCC and CRC_A is only transmitted if we know all the UID bits of the current Cascade Level.</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">    //</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment">    // Description of bytes 2-5: (Section 6.5.4 of the ISO/IEC 14443-3 draft: UID contents and cascade levels)</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">    //      UID size    Cascade level   Byte2   Byte3   Byte4   Byte5</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">    //      ========    =============   =====   =====   =====   =====</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">    //       4 bytes        1           uid0    uid1    uid2    uid3</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">    //       7 bytes        1           CT      uid0    uid1    uid2</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">    //                      2           uid3    uid4    uid5    uid6</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">    //      10 bytes        1           CT      uid0    uid1    uid2</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">    //                      2           CT      uid3    uid4    uid5</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">    //                      3           uid6    uid7    uid8    uid9</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment">    // Sanity checks</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment">    if (validBits &gt; 80) {</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="comment">        return STATUS_INVALID;</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment">    // Prepare MFRC522</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">    PCD_ClearRegisterBitMask(CollReg, 0x80);        // ValuesAfterColl=1 =&gt; Bits received after collision are cleared.</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">    // Repeat Cascade Level loop until we have a complete UID.</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">    uidComplete = false;</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment">    while (!uidComplete) {</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment">        // Set the Cascade Level in the SEL byte, find out if we need to use the Cascade Tag in byte 2.</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">        switch (cascadeLevel) {</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">            case 1:</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="comment">                buffer[0] = PICC_CMD_SEL_CL1;</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="comment">                uidIndex = 0;</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="comment">                useCascadeTag = validBits &amp;&amp; uid-&gt;size &gt; 4; // When we know that the UID has more than 4 bytes</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">            case 2:</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">                buffer[0] = PICC_CMD_SEL_CL2;</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">                uidIndex = 3;</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">                useCascadeTag = validBits &amp;&amp; uid-&gt;size &gt; 7; // When we know that the UID has more than 7 bytes</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">            case 3:</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">                buffer[0] = PICC_CMD_SEL_CL3;</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">                uidIndex = 6;</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">                useCascadeTag = false;                      // Never used in CL3.</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">            default:</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">                return STATUS_INTERNAL_ERROR;</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">                break;</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="comment">        // How many UID bits are known in this Cascade Level?</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">        currentLevelKnownBits = validBits - (8 * uidIndex);</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">        if (currentLevelKnownBits &lt; 0) {</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">            currentLevelKnownBits = 0;</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment">        // Copy the known bits from uid-&gt;uidByte[] to buffer[]</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">        index = 2; // destination index in buffer[]</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">        if (useCascadeTag) {</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment">            buffer[index++] = PICC_CMD_CT;</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="comment">        byte bytesToCopy = currentLevelKnownBits / 8 + (currentLevelKnownBits % 8 ? 1 : 0); // The number of bytes needed to represent the known bits for this level.</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">        if (bytesToCopy) {</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="comment">            byte maxBytes = useCascadeTag ? 3 : 4; // Max 4 bytes in each Cascade Level. Only 3 left if we use the Cascade Tag</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">            if (bytesToCopy &gt; maxBytes) {</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment">                bytesToCopy = maxBytes;</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">            for (count = 0; count &lt; bytesToCopy; count++) {</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment">                buffer[index++] = uid-&gt;uidByte[uidIndex + count];</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">        // Now that the data has been copied we need to include the 8 bits in CT in currentLevelKnownBits</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">        if (useCascadeTag) {</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">            currentLevelKnownBits += 8;</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">        // Repeat anti collision loop until we can transmit all UID bits + BCC and receive a SAK - max 32 iterations.</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">        selectDone = false;</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">        while (!selectDone) {</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">            // Find out how many bits and bytes to send and receive.</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">            if (currentLevelKnownBits &gt;= 32) { // All UID bits in this Cascade Level are known. This is a SELECT.</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">                //Serial.print(F(&quot;SELECT: currentLevelKnownBits=&quot;)); Serial.println(currentLevelKnownBits, DEC);</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">                buffer[1] = 0x70; // NVB - Number of Valid Bits: Seven whole bytes</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">                // Calculate BCC - Block Check Character</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">                buffer[6] = buffer[2] ^ buffer[3] ^ buffer[4] ^ buffer[5];</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">                // Calculate CRC_A</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">                result = PCD_CalculateCRC(buffer, 7, &amp;buffer[7]);</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">                if (result != STATUS_OK) {</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">                    return result;</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">                txLastBits      = 0; // 0 =&gt; All 8 bits are valid.</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">                bufferUsed      = 9;</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">                // Store response in the last 3 bytes of buffer (BCC and CRC_A - not needed after tx)</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">                responseBuffer  = &amp;buffer[6];</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">                responseLength  = 3;</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">            else { // This is an ANTICOLLISION.</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">                //Serial.print(F(&quot;ANTICOLLISION: currentLevelKnownBits=&quot;)); Serial.println(currentLevelKnownBits, DEC);</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">                txLastBits      = currentLevelKnownBits % 8;</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">                count           = currentLevelKnownBits / 8;    // Number of whole bytes in the UID part.</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">                index           = 2 + count;                    // Number of whole bytes: SEL + NVB + UIDs</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">                buffer[1]       = (index &lt;&lt; 4) + txLastBits;    // NVB - Number of Valid Bits</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">                bufferUsed      = index + (txLastBits ? 1 : 0);</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">                // Store response in the unused part of buffer</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">                responseBuffer  = &amp;buffer[index];</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">                responseLength  = sizeof(buffer) - index;</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">            // Set bit adjustments</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">            rxAlign = txLastBits;                                           // Having a seperate variable is overkill. But it makes the next line easier to read.</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">            PCD_WriteRegister(BitFramingReg, (rxAlign &lt;&lt; 4) + txLastBits);  // RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">            // Transmit the buffer and receive the response.</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">            result = PCD_TransceiveData(buffer, bufferUsed, responseBuffer, &amp;responseLength, &amp;txLastBits, rxAlign);</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">            if (result == STATUS_COLLISION) { // More than one PICC in the field =&gt; collision.</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">                result = PCD_ReadRegister(CollReg); // CollReg[7..0] bits are: ValuesAfterColl reserved CollPosNotValid CollPos[4:0]</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">                if (result &amp; 0x20) { // CollPosNotValid</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">                    return STATUS_COLLISION; // Without a valid collision position we cannot continue</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">                byte collisionPos = result &amp; 0x1F; // Values 0-31, 0 means bit 32.</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">                if (collisionPos == 0) {</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">                    collisionPos = 32;</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">                if (collisionPos &lt;= currentLevelKnownBits) { // No progress - should not happen</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">                    return STATUS_INTERNAL_ERROR;</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">                // Choose the PICC with the bit set.</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">                currentLevelKnownBits = collisionPos;</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">                count           = (currentLevelKnownBits - 1) % 8; // The bit to modify</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">                index           = 1 + (currentLevelKnownBits / 8) + (count ? 1 : 0); // First byte is index 0.</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">                buffer[index]   |= (1 &lt;&lt; count);</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment">            else if (result != STATUS_OK) {</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment">                return result;</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">            else { // STATUS_OK</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">                if (currentLevelKnownBits &gt;= 32) { // This was a SELECT.</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">                    selectDone = true; // No more anticollision</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">                    // We continue below outside the while.</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">                else { // This was an ANTICOLLISION.</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">                    // We now have all 32 bits of the UID in this Cascade Level</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">                    currentLevelKnownBits = 32;</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">                    // Run loop again to do the SELECT.</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">        } // End of while (!selectDone)</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">        // We do not check the CBB - it was constructed by us above.</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">        // Copy the found UID bytes from buffer[] to uid-&gt;uidByte[]</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">        index           = (buffer[2] == PICC_CMD_CT) ? 3 : 2; // source index in buffer[]</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">        bytesToCopy     = (buffer[2] == PICC_CMD_CT) ? 3 : 4;</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">        for (count = 0; count &lt; bytesToCopy; count++) {</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">            uid-&gt;uidByte[uidIndex + count] = buffer[index++];</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">        // Check response SAK (Select Acknowledge)</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">        if (responseLength != 3 || txLastBits != 0) { // SAK must be exactly 24 bits (1 byte + CRC_A).</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">            return STATUS_ERROR;</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">        // Verify CRC_A - do our own calculation and store the control in buffer[2..3] - those bytes are not needed anymore.</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">        result = PCD_CalculateCRC(responseBuffer, 1, &amp;buffer[2]);</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">        if (result != STATUS_OK) {</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">            return result;</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">        if ((buffer[2] != responseBuffer[1]) || (buffer[3] != responseBuffer[2])) {</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">            return STATUS_CRC_WRONG;</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">        if (responseBuffer[0] &amp; 0x04) { // Cascade bit set - UID not complete yes</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">            cascadeLevel++;</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">        else {</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">            uidComplete = true;</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">            uid-&gt;sak = responseBuffer[0];</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">    } // End of while (!uidComplete)</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">    // Set correct uid-&gt;size</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">    uid-&gt;size = 3 * cascadeLevel + 1;</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">    return STATUS_OK;</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment">} // End PICC_Select()</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">bool MFRC522::MIFARE_OpenUidBackdoor(bool logErrors) {</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">    // Magic sequence:</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">    // &gt; 50 00 57 CD (HALT + CRC)</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">    // &gt; 40 (7 bits only)</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">    // &lt; A (4 bits only)</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">    // &gt; 43</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">    // &lt; A (4 bits only)</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">    // Then you can write to sector 0 without authenticating</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">    PICC_HaltA(); // 50 00 57 CD</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">    byte cmd = 0x40;</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">    byte validBits = 7; // Our command is only 7 bits. After receiving card response, this will contain amount of valid response bits.</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">    byte response[32]; // Card&#39;s response is written here</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">    byte received;</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">    byte status = PCD_TransceiveData(&amp;cmd, (byte)1, response, &amp;received, &amp;validBits, (byte)0, false); // 40</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">    if(status != STATUS_OK) {</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">        if(logErrors) {</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">            Serial.println(F(&quot;Card did not respond to 0x40 after HALT command. Are you sure it is a UID changeable one?&quot;));</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">            Serial.print(F(&quot;Error name: &quot;));</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">    if (received != 1 || response[0] != 0x0A) {</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">            Serial.print(F(&quot;Got bad response on backdoor 0x40 command: &quot;));</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">            Serial.print(response[0], HEX);</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">            Serial.print(F(&quot; (&quot;));</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">            Serial.print(validBits);</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment">            Serial.print(F(&quot; valid bits)\r\n&quot;));</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">    cmd = 0x43;</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">    validBits = 8;</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment">    status = PCD_TransceiveData(&amp;cmd, (byte)1, response, &amp;received, &amp;validBits, (byte)0, false); // 43</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">    if(status != STATUS_OK) {</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">        if(logErrors) {</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment">            Serial.println(F(&quot;Error in communication at command 0x43, after successfully executing 0x40&quot;));</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">            Serial.print(F(&quot;Error name: &quot;));</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">    if (received != 1 || response[0] != 0x0A) {</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">            Serial.print(F(&quot;Got bad response on backdoor 0x43 command: &quot;));</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">            Serial.print(response[0], HEX);</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment">            Serial.print(F(&quot; (&quot;));</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">            Serial.print(validBits);</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment">            Serial.print(F(&quot; valid bits)\r\n&quot;));</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment">    // You can now write to sector 0 without authenticating!</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="comment">    return true;</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">} // End MIFARE_OpenUidBackdoor()</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment">bool MFRC522::MIFARE_SetUid(byte *newUid, byte uidSize, bool logErrors) {</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment">    // UID + BCC byte can not be larger than 16 together</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment">    if (!newUid || !uidSize || uidSize &gt; 15) {</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment">            Serial.println(F(&quot;New UID buffer empty, size 0, or size &gt; 15 given&quot;));</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">    // Authenticate for reading</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">    MIFARE_Key key = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment">    byte status = PCD_Authenticate(MFRC522::PICC_CMD_MF_AUTH_KEY_A, (byte)1, &amp;key, &amp;uid);</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment">    if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment">        if (status == STATUS_TIMEOUT) {</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">            // We get a read timeout if no card is selected yet, so let&#39;s select one</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment">            // Wake the card up again if sleeping</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">//            byte atqa_answer[2];</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">//            byte atqa_size = 2;</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment">//            PICC_WakeupA(atqa_answer, &amp;atqa_size);</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment">            if (!PICC_IsNewCardPresent() || !PICC_ReadCardSerial()) {</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">                Serial.println(F(&quot;No card was previously selected, and none are available. Failed to set UID.&quot;));</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">                return false;</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">            status = PCD_Authenticate(MFRC522::PICC_CMD_MF_AUTH_KEY_A, (byte)1, &amp;key, &amp;uid);</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">            if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">                // We tried, time to give up</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">                if (logErrors) {</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">                    Serial.println(F(&quot;Failed to authenticate to card for reading, could not set UID: &quot;));</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">                    Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment">                return false;</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">        else {</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">            if (logErrors) {</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">                Serial.print(F(&quot;PCD_Authenticate() failed: &quot;));</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">                Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">            return false;</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">    // Read block 0</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">    byte block0_buffer[18];</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">    byte byteCount = sizeof(block0_buffer);</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">    status = MIFARE_Read((byte)0, block0_buffer, &amp;byteCount);</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">    if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">            Serial.print(F(&quot;MIFARE_Read() failed: &quot;));</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">            Serial.println(F(&quot;Are you sure your KEY A for sector 0 is 0xFFFFFFFFFFFF?&quot;));</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">    // Write new UID to the data we just read, and calculate BCC byte</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">    byte bcc = 0;</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">    for (int i = 0; i &lt; uidSize; i++) {</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">        block0_buffer[i] = newUid[i];</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">        bcc ^= newUid[i];</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment">    // Write BCC byte to buffer</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">    block0_buffer[uidSize] = bcc;</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment">    // Stop encrypted traffic so we can send raw bytes</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment">    PCD_StopCrypto1();</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">    // Activate UID backdoor</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">    if (!MIFARE_OpenUidBackdoor(logErrors)) {</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">            Serial.println(F(&quot;Activating the UID backdoor failed.&quot;));</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">    // Write modified block 0 back to card</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">    status = MIFARE_Write((byte)0, block0_buffer, (byte)16);</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">    if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">            Serial.print(F(&quot;MIFARE_Write() failed: &quot;));</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">    // Wake the card up again</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">    byte atqa_answer[2];</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">    byte atqa_size = 2;</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">    PICC_WakeupA(atqa_answer, &amp;atqa_size);</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">    return true;</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">bool MFRC522::MIFARE_UnbrickUidSector(bool logErrors) {</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">    MIFARE_OpenUidBackdoor(logErrors);</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">    byte block0_buffer[] = {0x01, 0x02, 0x03, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">    // Write modified block 0 back to card</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">    byte status = MIFARE_Write((byte)0, block0_buffer, (byte)16);</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">    if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">        if (logErrors) {</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">            Serial.print(F(&quot;MIFARE_Write() failed: &quot;));</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160; <span class="comment">/*</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment">void MFRC522::PICC_DumpMifareClassicToSerial(   Uid *uid,       ///&lt; Pointer to Uid struct returned from a successful PICC_Select().</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment">                                                byte piccType,  ///&lt; One of the PICC_Type enums.</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment">                                                MIFARE_Key *key ///&lt; Key A used for all sectors.</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">                                            ) {</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">    byte no_of_sectors = 0;</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment">    switch (piccType) {</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">        case PICC_TYPE_MIFARE_MINI:</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment">            // Has 5 sectors * 4 blocks/sector * 16 bytes/block = 320 bytes.</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">            no_of_sectors = 5;</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="comment">            break;</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment">        case PICC_TYPE_MIFARE_1K:</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">            // Has 16 sectors * 4 blocks/sector * 16 bytes/block = 1024 bytes.</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment">            no_of_sectors = 16;</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">            break;</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">        case PICC_TYPE_MIFARE_4K:</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment">            // Has (32 sectors * 4 blocks/sector + 8 sectors * 16 blocks/sector) * 16 bytes/block = 4096 bytes.</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">            no_of_sectors = 40;</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">            break;</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">        default: // Should not happen. Ignore.</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">            break;</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment">    // Dump sectors, highest address first.</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment">    if (no_of_sectors) {</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="comment">        Serial.println(F(&quot;Sector Block   0  1  2  3   4  5  6  7   8  9 10 11  12 13 14 15  AccessBits&quot;));</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">        for (int8_t i = no_of_sectors - 1; i &gt;= 0; i--) {</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">            PICC_DumpMifareClassicSectorToSerial(uid, key, i);</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">    PICC_HaltA(); // Halt the PICC before stopping the encrypted session.</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">    PCD_StopCrypto1();</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment">} // End PICC_DumpMifareClassicToSerial()</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment">void MFRC522::PICC_DumpMifareClassicSectorToSerial(Uid *uid,            ///&lt; Pointer to Uid struct returned from a successful PICC_Select().</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">                                                    MIFARE_Key *key,    ///&lt; Key A for the sector.</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">                                                    byte sector         ///&lt; The sector to dump, 0..39.</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">                                                    ) {</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment">    byte status;</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">    byte firstBlock;        // Address of lowest address to dump actually last block dumped)</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">    byte no_of_blocks;      // Number of blocks in sector</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">    bool isSectorTrailer;   // Set to true while handling the &quot;last&quot; (ie highest address) in the sector.</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="comment">    // The access bits are stored in a peculiar fashion.</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">    // There are four groups:</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">    //      g[3]    Access bits for the sector trailer, block 3 (for sectors 0-31) or block 15 (for sectors 32-39)</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">    //      g[2]    Access bits for block 2 (for sectors 0-31) or blocks 10-14 (for sectors 32-39)</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">    //      g[1]    Access bits for block 1 (for sectors 0-31) or blocks 5-9 (for sectors 32-39)</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">    //      g[0]    Access bits for block 0 (for sectors 0-31) or blocks 0-4 (for sectors 32-39)</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment">    // Each group has access bits [C1 C2 C3]. In this code C1 is MSB and C3 is LSB.</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="comment">    // The four CX bits are stored together in a nible cx and an inverted nible cx_.</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment">    byte c1, c2, c3;        // Nibbles</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="comment">    byte c1_, c2_, c3_;     // Inverted nibbles</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="comment">    bool invertedError;     // True if one of the inverted nibbles did not match</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="comment">    byte g[4];              // Access bits for each of the four groups.</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">    byte group;             // 0-3 - active group for access bits</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment">    bool firstInGroup;      // True for the first block dumped in the group</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">    // Determine position and size of sector.</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">    if (sector &lt; 32) { // Sectors 0..31 has 4 blocks each</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment">        no_of_blocks = 4;</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment">        firstBlock = sector * no_of_blocks;</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment">    else if (sector &lt; 40) { // Sectors 32-39 has 16 blocks each</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment">        no_of_blocks = 16;</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="comment">        firstBlock = 128 + (sector - 32) * no_of_blocks;</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="comment">    else { // Illegal input, no MIFARE Classic PICC has more than 40 sectors.</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment">        return;</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="comment">    // Dump blocks, highest address first.</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment">    byte byteCount;</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">    byte buffer[18];</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment">    byte blockAddr;</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">    isSectorTrailer = true;</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">    for (int8_t blockOffset = no_of_blocks - 1; blockOffset &gt;= 0; blockOffset--) {</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">        blockAddr = firstBlock + blockOffset;</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment">        // Sector number - only on first line</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment">        if (isSectorTrailer) {</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">            if(sector &lt; 10)</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">                Serial.print(F(&quot;   &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">            else</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="comment">                Serial.print(F(&quot;  &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">            Serial.print(sector);</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="comment">            Serial.print(F(&quot;   &quot;));</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="comment">        else {</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment">            Serial.print(F(&quot;       &quot;));</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">        // Block number</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">        if(blockAddr &lt; 10)</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment">            Serial.print(F(&quot;   &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="comment">        else {</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="comment">            if(blockAddr &lt; 100)</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment">                Serial.print(F(&quot;  &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="comment">            else</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="comment">                Serial.print(F(&quot; &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">        Serial.print(blockAddr);</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">        Serial.print(F(&quot;  &quot;));</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">        // Establish encrypted communications before reading the first block</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">        if (isSectorTrailer) {</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment">            status = PCD_Authenticate(PICC_CMD_MF_AUTH_KEY_A, firstBlock, key, uid);</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="comment">            if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">                Serial.print(F(&quot;PCD_Authenticate() failed: &quot;));</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment">                Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="comment">                return;</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;<span class="comment">        // Read block</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="comment">        byteCount = sizeof(buffer);</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment">        status = MIFARE_Read(blockAddr, buffer, &amp;byteCount);</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="comment">        if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment">            Serial.print(F(&quot;MIFARE_Read() failed: &quot;));</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment">            continue;</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment">        // Dump data</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment">        for (byte index = 0; index &lt; 16; index++) {</span></div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment">            if(buffer[index] &lt; 0x10)</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="comment">                Serial.print(F(&quot; 0&quot;));</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="comment">            else</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="comment">                Serial.print(F(&quot; &quot;));</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="comment">            Serial.print(buffer[index], HEX);</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="comment">            if ((index % 4) == 3) {</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;<span class="comment">                Serial.print(F(&quot; &quot;));</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="comment">        // Parse sector trailer data</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="comment">        if (isSectorTrailer) {</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="comment">            c1  = buffer[7] &gt;&gt; 4;</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="comment">            c2  = buffer[8] &amp; 0xF;</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="comment">            c3  = buffer[8] &gt;&gt; 4;</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="comment">            c1_ = buffer[6] &amp; 0xF;</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="comment">            c2_ = buffer[6] &gt;&gt; 4;</span></div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="comment">            c3_ = buffer[7] &amp; 0xF;</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="comment">            invertedError = (c1 != (~c1_ &amp; 0xF)) || (c2 != (~c2_ &amp; 0xF)) || (c3 != (~c3_ &amp; 0xF));</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="comment">            g[0] = ((c1 &amp; 1) &lt;&lt; 2) | ((c2 &amp; 1) &lt;&lt; 1) | ((c3 &amp; 1) &lt;&lt; 0);</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="comment">            g[1] = ((c1 &amp; 2) &lt;&lt; 1) | ((c2 &amp; 2) &lt;&lt; 0) | ((c3 &amp; 2) &gt;&gt; 1);</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="comment">            g[2] = ((c1 &amp; 4) &lt;&lt; 0) | ((c2 &amp; 4) &gt;&gt; 1) | ((c3 &amp; 4) &gt;&gt; 2);</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">            g[3] = ((c1 &amp; 8) &gt;&gt; 1) | ((c2 &amp; 8) &gt;&gt; 2) | ((c3 &amp; 8) &gt;&gt; 3);</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment">            isSectorTrailer = false;</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="comment">        // Which access group is this block in?</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="comment">        if (no_of_blocks == 4) {</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="comment">            group = blockOffset;</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="comment">            firstInGroup = true;</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="comment">        else {</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;<span class="comment">            group = blockOffset / 5;</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="comment">            firstInGroup = (group == 3) || (group != (blockOffset + 1) / 5);</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="comment">        if (firstInGroup) {</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="comment">            // Print access bits</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="comment">            Serial.print(F(&quot; [ &quot;));</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;<span class="comment">            Serial.print((g[group] &gt;&gt; 2) &amp; 1, DEC); Serial.print(F(&quot; &quot;));</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="comment">            Serial.print((g[group] &gt;&gt; 1) &amp; 1, DEC); Serial.print(F(&quot; &quot;));</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="comment">            Serial.print((g[group] &gt;&gt; 0) &amp; 1, DEC);</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="comment">            Serial.print(F(&quot; ] &quot;));</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="comment">            if (invertedError) {</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">                Serial.print(F(&quot; Inverted access bits did not match! &quot;));</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">        if (group != 3 &amp;&amp; (g[group] == 1 || g[group] == 6)) { // Not a sector trailer, a value block</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment">            long value = (long(buffer[3])&lt;&lt;24) | (long(buffer[2])&lt;&lt;16) | (long(buffer[1])&lt;&lt;8) | long(buffer[0]);</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment">            Serial.print(F(&quot; Value=0x&quot;)); Serial.print(value, HEX);</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment">            Serial.print(F(&quot; Adr=0x&quot;)); Serial.print(buffer[12], HEX);</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment">        Serial.println();</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;<span class="comment">    return;</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="comment">} // End PICC_DumpMifareClassicSectorToSerial()</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment">void MFRC522::PICC_DumpMifareUltralightToSerial() {</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">    byte status;</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment">    byte byteCount;</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="comment">    byte buffer[18];</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;<span class="comment">    byte i;</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="comment">    Serial.println(F(&quot;Page  0  1  2  3&quot;));</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="comment">    // Try the mpages of the original Ultralight. Ultralight C has more pages.</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="comment">    for (byte page = 0; page &lt; 16; page +=4) { // Read returns data for 4 pages at a time.</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="comment">        // Read pages</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="comment">        byteCount = sizeof(buffer);</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="comment">        status = MIFARE_Read(page, buffer, &amp;byteCount);</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;<span class="comment">        if (status != STATUS_OK) {</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="comment">            Serial.print(F(&quot;MIFARE_Read() failed: &quot;));</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="comment">            Serial.println(GetStatusCodeName(status));</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;<span class="comment">            break;</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment">        // Dump data</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment">        for (byte offset = 0; offset &lt; 4; offset++) {</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment">            i = page + offset;</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment">            if(i &lt; 10)</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment">                Serial.print(F(&quot;  &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment">            else</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="comment">                Serial.print(F(&quot; &quot;)); // Pad with spaces</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment">            Serial.print(i);</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">            Serial.print(F(&quot;  &quot;));</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment">            for (byte index = 0; index &lt; 4; index++) {</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">                i = 4 * offset + index;</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">                if(buffer[i] &lt; 0x10)</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment">                    Serial.print(F(&quot; 0&quot;));</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="comment">                else</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment">                    Serial.print(F(&quot; &quot;));</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">                Serial.print(buffer[i], HEX);</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">            Serial.println();</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment">} // End PICC_DumpMifareUltralightToSerial()</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment">*/</span></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aff575332e484bda25f49d6fcaf9a0d65"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aff575332e484bda25f49d6fcaf9a0d65">PCD_REG_GsNReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:72</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca8985fa08e3634abc0229923901e5bd97"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca8985fa08e3634abc0229923901e5bd97">PICC_CMD_MF_TRANSFER</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:143</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a5367c43aa316d6c7509af27a451b7e8b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a5367c43aa316d6c7509af27a451b7e8b">MFRC522_MIFARE_Transfer</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Transfer(uint8_t blockAddr)</div><div class="ttdoc">Ecrit le contenu de la mémoire volatile dans un block. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1462</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_adcfd150891e3c490a177710205fa6f86"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#adcfd150891e3c490a177710205fa6f86">MFRC522_PCD_TransceiveData</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PCD_TransceiveData(uint8_t *sendData, uint8_t sendLen, uint8_t *backData, uint8_t *backLen, uint8_t *validBits, uint8_t rxAlign, uint8_t checkCRC)</div><div class="ttdoc">Exécute la commande de transfert dans la FIFO du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:724</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129">PCD_CMD</a></div><div class="ttdeci">PCD_CMD</div><div class="ttdoc">Commandes du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:105</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_ac23dafc7582c3002cb52d0389a41c1ec"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#ac23dafc7582c3002cb52d0389a41c1ec">MFRC522_PICC_Select</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PICC_Select(MFRC522_PICC_UID *uid)</div><div class="ttdoc">Sélectionne un PICC. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:784</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a74cf62f3f9d28ce418914030cc75aecc"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a74cf62f3f9d28ce418914030cc75aecc">PCD_REG_TxModeReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:49</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a856c2fbda471317477c4d9c6f6f51cf5"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a856c2fbda471317477c4d9c6f6f51cf5">PCD_REG_DivIEnReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:32</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea9e0213161362742f92643edce79d1e0a"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea9e0213161362742f92643edce79d1e0a">MFRC522_PICC_TYPE_MIFARE_1K_INFINEON</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:178</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a5db5c6c4a64c5846a677753cf75ad187"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a5db5c6c4a64c5846a677753cf75ad187">PCD_CMD_SoftReset</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:116</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6eaf9380812869951aa2e681c405eb0c754"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eaf9380812869951aa2e681c405eb0c754">MFRC522_PICC_TYPE_MIFARE_4K_EMUL</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:177</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aff7ee2a68796dbf4d5f1d8433d41b083"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aff7ee2a68796dbf4d5f1d8433d41b083">MFRC522_PICC_GetType</a></div><div class="ttdeci">MFRC522_PICC_TYPE MFRC522_PICC_GetType(MFRC522_PICC_UID *uid)</div><div class="ttdoc">Récupère le type de carte en fonction de son SAK. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1524</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_acdbe3a27cd1e8f170a87b42b9fc1a43e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#acdbe3a27cd1e8f170a87b42b9fc1a43e">MFRC522_PCD_AntennaOn</a></div><div class="ttdeci">void MFRC522_PCD_AntennaOn()</div><div class="ttdoc">Allume l&#39;antenne. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:412</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea82440ae14051cfd6a163c44a368ceb37"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea82440ae14051cfd6a163c44a368ceb37">MFRC522_PICC_TYPE_MIFARE_MINI</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:169</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7aed60c850eb757e8c9bb408da0b9f2460">MFRC522_STATUS_OK</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:128</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acad213da8df255bc6ff7cca5b7a28da7b4"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad213da8df255bc6ff7cca5b7a28da7b4">PICC_CMD_REQA</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:126</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a2dc37d32070c817377788f04bcf65e1a"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a2dc37d32070c817377788f04bcf65e1a">PCD_REG_TPrescalerReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:76</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_ab7604f9c7275cd561647f60c6c8458b4"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#ab7604f9c7275cd561647f60c6c8458b4">MFRC522_PICC_WakeupA</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PICC_WakeupA(MFRC522_PICC_UID *uid)</div><div class="ttdoc">Envoi une commande Wakeup type A. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:779</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_ac98baa28a6ff47681af94d1fc0c2b7c9"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#ac98baa28a6ff47681af94d1fc0c2b7c9">MFRC522_PCD_ReadRegister</a></div><div class="ttdeci">uint8_t MFRC522_PCD_ReadRegister(PCD_REG reg)</div><div class="ttdoc">Lit la valeur d&#39;un registre du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:251</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_afc8a5afccee76df36d3ed3f8348fefb8"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#afc8a5afccee76df36d3ed3f8348fefb8">MFRC522_PICC_REQA_or_WUPA</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PICC_REQA_or_WUPA(PICC_CMD command, MFRC522_PICC_UID *uid)</div><div class="ttdoc">Envoi une commande Wakeup ou Request de type A. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:748</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a5f030b32e2182ae7b70398bf5f38095b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a5f030b32e2182ae7b70398bf5f38095b">MFRC522_PCD_CommunicateWithPICC</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PCD_CommunicateWithPICC(PCD_CMD command, uint8_t waitIrq, uint8_t *sendData, uint8_t sendLen, uint8_t *backData, uint8_t *backLen, uint8_t *validBits, uint8_t rxAlign, uint8_t checkCRC)</div><div class="ttdoc">Exécute la commande de transfert dans la FIFO du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:594</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_af652f395989dbce8064a5679115fa9cf"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#af652f395989dbce8064a5679115fa9cf">MFRC522_MIFARE_Write</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Write(uint8_t blockAddr, uint8_t *buffer, uint8_t bufferSize)</div><div class="ttdoc">Ecrit 16 octets sur le PICC ACTIF. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1422</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a89adaf1e8ac46b6d0c7bb83c58d152d4"><div class="ttname"><a href="_m_f_r_c522_8h.html#a89adaf1e8ac46b6d0c7bb83c58d152d4">MFRC522_AUTH_KEY</a></div><div class="ttdeci">MFRC522_AUTH_KEY</div><div class="ttdoc">Types d&#39;authentifications. </div><div class="ttdef"><b>Definition:</b> MFRC522.h:187</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0e2f2cc1d1d0d86af82cc289607d498e">PCD_REG_TxControlReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:51</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a096082dcc584f4e93f45a58206363a8c"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a096082dcc584f4e93f45a58206363a8c">MFRC522_MIFARE_TwoStepHelper</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_TwoStepHelper(PICC_CMD command, uint8_t blockAddr, int32_t data)</div><div class="ttdoc">Fonction utilitaire pour encapsuler le protocole de communication MIFARE des opérations Decrement...</div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1341</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a41b8c36b24ba229cc192a792caac62d0"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a41b8c36b24ba229cc192a792caac62d0">MFRC522_PICC_RequestA</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PICC_RequestA(MFRC522_PICC_UID *uid)</div><div class="ttdoc">Envoi une commande Request type A. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:774</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aa5ca6010d626de6318c497b2e030a772"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa5ca6010d626de6318c497b2e030a772">PCD_REG_MfRxReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:60</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7">MFRC522_STATUS</a></div><div class="ttdeci">MFRC522_STATUS</div><div class="ttdoc">Codes retour des fonctions de la bibliothèque. </div><div class="ttdef"><b>Definition:</b> MFRC522.h:126</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33ae3a1ca472ee1a44cedb6278b002ce71b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ae3a1ca472ee1a44cedb6278b002ce71b">PCD_REG_TestDAC1Reg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:92</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6eaa0842ffe78c7eb0e3e50023ab8555206"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eaa0842ffe78c7eb0e3e50023ab8555206">MFRC522_PICC_TYPE_MIFARE_1K</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:170</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a3547fc0462c7e2b611d68166b1a762c7"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3547fc0462c7e2b611d68166b1a762c7">PCD_REG_TReloadRegH</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:77</div></div>
<div class="ttc" id="_s_p_i__master_8h_html_a2eb086fbbace1373fea415c9cc9953d3"><div class="ttname"><a href="_s_p_i__master_8h.html#a2eb086fbbace1373fea415c9cc9953d3">SPI_EnableSlave</a></div><div class="ttdeci">#define SPI_EnableSlave()</div><div class="ttdoc">Active l&#39;esclave SPI. </div><div class="ttdef"><b>Definition:</b> SPI_master.h:156</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a8d6496f8cf42e6dcb95019637816fec4"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a8d6496f8cf42e6dcb95019637816fec4">PCD_REG_Status2Reg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:37</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6e"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6e">MFRC522_PICC_TYPE</a></div><div class="ttdeci">MFRC522_PICC_TYPE</div><div class="ttdoc">Types de PICC ou de TAG. </div><div class="ttdef"><b>Definition:</b> MFRC522.h:164</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_ae08583699989a52ba709c10416da4049"><div class="ttname"><a href="_m_f_r_c522_8h.html#ae08583699989a52ba709c10416da4049">MFRC522_AUTH_KEY_SIZE</a></div><div class="ttdeci">#define MFRC522_AUTH_KEY_SIZE</div><div class="ttdef"><b>Definition:</b> MFRC522.h:204</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca95cc086aa9fc83fe999b43f6c508ff19"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95cc086aa9fc83fe999b43f6c508ff19">PICC_CMD_WUPA</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:127</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_ad060eed5c2f314197b59d052572aab14"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#ad060eed5c2f314197b59d052572aab14">MFRC522_MIFARE_Decrement</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Decrement(uint8_t blockAddr, int32_t delta)</div><div class="ttdoc">Soustrait le delta de la valeur stockée à l&#39;adresse du bloc et stock le résultat dans la mémoire vola...</div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1447</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a0b8d835ea355a4817462616596bf9bff"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a0b8d835ea355a4817462616596bf9bff">FM17522_firmware_reference</a></div><div class="ttdeci">const uint8_t PROGMEM FM17522_firmware_reference[]</div><div class="ttdoc">Firmware de la version Fudan Semiconductor FM17522 (clone du MFRC522) </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:183</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a1614845f5f84e683c97e84aed6dfd255"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a1614845f5f84e683c97e84aed6dfd255">MFRC522_STATUS_CRC_WRONG</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:135</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a21cfbed66ddd5ea30f1e18718f38822b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a21cfbed66ddd5ea30f1e18718f38822b">PCD_CMD_Mem</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:108</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca881588d3cca42490c71666c97b55a6c8"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca881588d3cca42490c71666c97b55a6c8">PICC_CMD_HLTA</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:132</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a84cc983cf30be66f1a9c77e9434dab06"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a84cc983cf30be66f1a9c77e9434dab06">PCD_CMD_GenerateRandomID</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:109</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500ac"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500ac">PICC_CMD</a></div><div class="ttdeci">PICC_CMD</div><div class="ttdoc">Commandes envoyé à un PICC. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:123</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a87bce03f7e7673fe3e14b301173ad443"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a87bce03f7e7673fe3e14b301173ad443">PCD_REG_TestADCReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:94</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33ac0d6b81c1c0d8673b2419576a5a413ae"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac0d6b81c1c0d8673b2419576a5a413ae">PCD_REG_TestSel2Reg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:85</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a580beecddfd163115ca42f7e42d860f7"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a580beecddfd163115ca42f7e42d860f7">PCD_REG_ModWidthReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:69</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33afb39e1757ce1146f7919c3ede2e66898"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33afb39e1757ce1146f7919c3ede2e66898">PCD_REG_CWGsPReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:73</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a42cba06e7ef4cfa9afba588d7273e674"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a42cba06e7ef4cfa9afba588d7273e674">MFRC522_PCD_ReadRegisterArray</a></div><div class="ttdeci">void MFRC522_PCD_ReadRegisterArray(PCD_REG reg, uint8_t count, uint8_t *values, uint8_t rxAlign)</div><div class="ttdoc">Lit les valeurs d&#39;un registre du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:274</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a6d169d8a5ccbca55a4eaa56910620e1b">PCD_CMD_Idle</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:107</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a0f45f3bb94d961288e224e6262f36ee0"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a0f45f3bb94d961288e224e6262f36ee0">PCD_REG_ControlReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:41</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33ab1dbe3f2cc2589509b9d77e34ee757b5"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ab1dbe3f2cc2589509b9d77e34ee757b5">PCD_REG_RxThresholdReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:55</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a93a13da90845d8c9c3fa78c158854195"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a93a13da90845d8c9c3fa78c158854195">PCD_REG_ComIEnReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:31</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a89adaf1e8ac46b6d0c7bb83c58d152d4a1050aafc23ebab8d7c32a82fdfdaf954"><div class="ttname"><a href="_m_f_r_c522_8h.html#a89adaf1e8ac46b6d0c7bb83c58d152d4a1050aafc23ebab8d7c32a82fdfdaf954">MFRC522_AUTH_KEY_A</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:189</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33accd00177ef7a31226e85829a313cfaf2"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33accd00177ef7a31226e85829a313cfaf2">PCD_REG_BitFramingReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:42</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a89adaf1e8ac46b6d0c7bb83c58d152d4af338d6034d98313cb5f2b2ce58f8e8cd"><div class="ttname"><a href="_m_f_r_c522_8h.html#a89adaf1e8ac46b6d0c7bb83c58d152d4af338d6034d98313cb5f2b2ce58f8e8cd">MFRC522_AUTH_KEY_B</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:190</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a11ee075ea907230de403411986876ad5"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a11ee075ea907230de403411986876ad5">MFRC522_MIFARE_Restore</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Restore(uint8_t blockAddr)</div><div class="ttdoc">Place la valeur stockée à l&#39;adresse d&#39;un bloc dans la mémoire volatile. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1457</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea9c158029c33cf5f4af7e5500d4a1adc3"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea9c158029c33cf5f4af7e5500d4a1adc3">MFRC522_PICC_TYPE_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:166</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a75eefa4a167beec953bf2d34443c9935">PCD_REG_RFCfgReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:71</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aa75102bb88c62cd9c384199c491f3045"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aa75102bb88c62cd9c384199c491f3045">MFRC522_PCD_Init</a></div><div class="ttdeci">void MFRC522_PCD_Init()</div><div class="ttdoc">Initialise l&#39;interface SPI. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:426</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7afd52fd20b34b011fbec8d5062a0f87e1"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afd52fd20b34b011fbec8d5062a0f87e1">MFRC522_STATUS_NO_ROOM</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:132</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8747255baf96533a382042038f5d01e2"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8747255baf96533a382042038f5d01e2">MFRC522_RX_GAIN</a></div><div class="ttdeci">MFRC522_RX_GAIN</div><div class="ttdoc">Gain de l&#39;antenne du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522.h:145</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea7c1ca3a1d6007e3d8756683fbe9a2f29"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea7c1ca3a1d6007e3d8756683fbe9a2f29">MFRC522_PICC_TYPE_MIFARE_PLUS</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:173</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca2fc1e0ba00730e380391575d5660309a"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca2fc1e0ba00730e380391575d5660309a">PICC_CMD_SEL_CL3</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:131</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129ac4e63bc2d9f070830d7381c1b469108d"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129ac4e63bc2d9f070830d7381c1b469108d">PCD_CMD_Transmit</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:111</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a39edefa4be0db73b639644f19aa79bbc"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a39edefa4be0db73b639644f19aa79bbc">MFRC522_MIFARE_ACK</a></div><div class="ttdeci">#define MFRC522_MIFARE_ACK</div><div class="ttdoc">Les cartes MIFARE Classic utilisent un ACK/NAK de 4 bits. Tout autres valeur que 0xA est un NAK...</div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:197</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea6b65c8717db71b024d2a7a123b32a74f"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea6b65c8717db71b024d2a7a123b32a74f">MFRC522_PICC_TYPE_JCOP30</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:176</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a57a4e9574d9d35a55d97736855c2a79e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a57a4e9574d9d35a55d97736855c2a79e">MFRC522_PCD_GetAntennaGain</a></div><div class="ttdeci">MFRC522_RX_GAIN MFRC522_PCD_GetAntennaGain()</div><div class="ttdoc">Obtient le gain de l&#39;antenne. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:468</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33af6af9e44f1c02fcd57f431ff969b5361"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33af6af9e44f1c02fcd57f431ff969b5361">PCD_REG_RxSelReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:54</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a7d00e13ef93354b5b523f7267b47fdf7"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a7d00e13ef93354b5b523f7267b47fdf7">MFRC522_MIFARE_SetAccessBits</a></div><div class="ttdeci">void MFRC522_MIFARE_SetAccessBits(uint8_t *accessBitBuffer, uint8_t g0, uint8_t g1, uint8_t g2, uint8_t g3)</div><div class="ttdoc">Calcul le bit pattern des bits d&#39;accès. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1585</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a3bea9206a0e75952543dc4947f08ba68"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a3bea9206a0e75952543dc4947f08ba68">PCD_REG_RxModeReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:50</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a07a75330085096bd5fdddf91b7b823c2">PCD_REG_CommandReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:30</div></div>
<div class="ttc" id="struct_m_f_r_c522___p_i_c_c___u_i_d_html_aa40e597ecb1bc0921f029f6f6653fb17"><div class="ttname"><a href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#aa40e597ecb1bc0921f029f6f6653fb17">MFRC522_PICC_UID::atqa</a></div><div class="ttdeci">uint16_t atqa</div><div class="ttdef"><b>Definition:</b> MFRC522.h:198</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a7cfb5852dc3490759c7c6e464a6bd3a9"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a7cfb5852dc3490759c7c6e464a6bd3a9">PCD_REG_TestPinValueReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:87</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a627fb17aba855e860a82e8b7300f7e94"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a627fb17aba855e860a82e8b7300f7e94">MFRC522_STATUS_MIFARE_NACK</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:136</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea54181fb39067b717ec991e8b7cee9b8c"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea54181fb39067b717ec991e8b7cee9b8c">MFRC522_PICC_TYPE_ISO_14443_4</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:167</div></div>
<div class="ttc" id="_s_p_i__master_8h_html_a1a7159977e7a69ed49beed0a2019af9b"><div class="ttname"><a href="_s_p_i__master_8h.html#a1a7159977e7a69ed49beed0a2019af9b">SPI_DisableSlave</a></div><div class="ttdeci">#define SPI_DisableSlave()</div><div class="ttdoc">Désactive l&#39;esclave SPI. </div><div class="ttdef"><b>Definition:</b> SPI_master.h:165</div></div>
<div class="ttc" id="struct_m_f_r_c522___p_i_c_c___u_i_d_html_ac540a995e737d0311f158bbf1814b2b6"><div class="ttname"><a href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#ac540a995e737d0311f158bbf1814b2b6">MFRC522_PICC_UID::uid</a></div><div class="ttdeci">uint8_t uid[10]</div><div class="ttdef"><b>Definition:</b> MFRC522.h:199</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a1becdd93cb0549cd762640c1931c3ed9"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1becdd93cb0549cd762640c1931c3ed9">PCD_REG_AnalogTestReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:91</div></div>
<div class="ttc" id="struct_m_f_r_c522___p_i_c_c___u_i_d_html_aff9ecf1799e6a1b0c8e67c77b50063ad"><div class="ttname"><a href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#aff9ecf1799e6a1b0c8e67c77b50063ad">MFRC522_PICC_UID::uidsize</a></div><div class="ttdeci">uint8_t uidsize</div><div class="ttdef"><b>Definition:</b> MFRC522.h:200</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aed86368899a03917651fb6171d3100b4">PCD_REG_DivIrqReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:34</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33afd742d6b7e591346eb016c6d6905e15f"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33afd742d6b7e591346eb016c6d6905e15f">PCD_REG_TestBusReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:88</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea66d516f2f32de4afb43216b5ccf86804"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea66d516f2f32de4afb43216b5ccf86804">MFRC522_PICC_TYPE_MIFARE_4K</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:171</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129acbfb109197e667e9a10428e26f554eec"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129acbfb109197e667e9a10428e26f554eec">PCD_CMD_Receive</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:113</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aa643aee0562bf611da3d63b699cc1d9d"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa643aee0562bf611da3d63b699cc1d9d">PCD_REG_TxSelReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:53</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea83f7ce6e4e57aacd2202e4f46cafb5d7"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea83f7ce6e4e57aacd2202e4f46cafb5d7">MFRC522_PICC_TYPE_TNP3XXX</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:174</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a134cfc31312e5d90455e362f4ba2b3a9"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a134cfc31312e5d90455e362f4ba2b3a9">PCD_REG_CRCResultRegL</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:67</div></div>
<div class="ttc" id="struct_m_f_r_c522___m_i_f_a_r_e___k_e_y_html"><div class="ttname"><a href="struct_m_f_r_c522___m_i_f_a_r_e___k_e_y.html">MFRC522_MIFARE_KEY</a></div><div class="ttdoc">Structure d&#39;une clef Crypto1 MIFARE. </div><div class="ttdef"><b>Definition:</b> MFRC522.h:209</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129afe10d8d4db13ee062d6c8420932ad0ef"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129afe10d8d4db13ee062d6c8420932ad0ef">PCD_CMD_NoCmdChange</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:112</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33ac745e1397e9a60e76b19248531491ba9"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac745e1397e9a60e76b19248531491ba9">PCD_REG_TCounterValueRegL</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:80</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acad2cedf2b5b620a6d874f0b8360e7e36c"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acad2cedf2b5b620a6d874f0b8360e7e36c">PICC_CMD_MF_READ</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:138</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca95ad7ce4f4272886b6756b49f3aeaf9a"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca95ad7ce4f4272886b6756b49f3aeaf9a">PICC_CMD_MF_AUTH_KEY_B</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:137</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a65ebd01d137d21794cbb3649189006ca"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a65ebd01d137d21794cbb3649189006ca">MFRC522_PCD_SetAntennaGain</a></div><div class="ttdeci">void MFRC522_PCD_SetAntennaGain(MFRC522_RX_GAIN gain)</div><div class="ttdoc">Définit le gain de l&#39;antenne. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:473</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a4e859fdaca136ea69b6d1a15d8ce42bb"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a4e859fdaca136ea69b6d1a15d8ce42bb">PCD_REG_TxASKReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:52</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a9f1455eb011b595fce71f1c334c3452b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a9f1455eb011b595fce71f1c334c3452b">PCD_CMD_MFAuthent</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:115</div></div>
<div class="ttc" id="struct_m_f_r_c522___p_i_c_c___u_i_d_html"><div class="ttname"><a href="struct_m_f_r_c522___p_i_c_c___u_i_d.html">MFRC522_PICC_UID</a></div><div class="ttdoc">Structure contenant l&#39;UID d&#39;un PICC. </div><div class="ttdef"><b>Definition:</b> MFRC522.h:196</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33">PCD_REG</a></div><div class="ttdeci">PCD_REG</div><div class="ttdoc">Registres sur MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:26</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a7a43eff2d34ea3415e08e1d7e5f0bdd5"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a7a43eff2d34ea3415e08e1d7e5f0bdd5">PCD_REG_TestPinEnReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:86</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_addc9d748d171be1bb8a76dd80e10452f"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#addc9d748d171be1bb8a76dd80e10452f">MFRC522_firmware_referenceV2_0</a></div><div class="ttdeci">const uint8_t PROGMEM MFRC522_firmware_referenceV2_0[]</div><div class="ttdoc">Firmware de la version 2.0 du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:168</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a548fd7c84c1a6058fcd3940451399035"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a548fd7c84c1a6058fcd3940451399035">MFRC522_MIFARE_Transceive</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Transceive(uint8_t *sendData, uint8_t sendLen, uint8_t acceptTimeout)</div><div class="ttdoc">Fonction utilitaire pour encapsuler le protocole de communication MIFARE. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1281</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aaaaf507911a757965d739733b9ae6535"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aaaaf507911a757965d739733b9ae6535">PCD_REG_Status1Reg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:36</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a9cfd56bdca38c4ccefebd21c375d5138"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a9cfd56bdca38c4ccefebd21c375d5138">MFRC522_PCD_SetRegisterBitMask</a></div><div class="ttdeci">void MFRC522_PCD_SetRegisterBitMask(PCD_REG reg, uint8_t mask)</div><div class="ttdoc">Postionne un mask sur un regitre donné </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:333</div></div>
<div class="ttc" id="alpha__core_8h_html_a2b57cb76dacf237936bbc252282e34d2"><div class="ttname"><a href="alpha__core_8h.html#a2b57cb76dacf237936bbc252282e34d2">SPI_SendByte</a></div><div class="ttdeci">void SPI_SendByte(uint8_t data)</div><div class="ttdoc">Transmet un byte sur la liaison SPI. </div><div class="ttdef"><b>Definition:</b> alpha_core.h:37</div></div>
<div class="ttc" id="_s_p_i__master_8h_html"><div class="ttname"><a href="_s_p_i__master_8h.html">SPI_master.h</a></div><div class="ttdoc">Protocole de communication SPI maitre. </div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca0329cc76c269606689b6c3b35683136c"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0329cc76c269606689b6c3b35683136c">PICC_CMD_MF_DECREMENT</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:140</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca0a14c55a640535db5c46ce0110df7a44"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca0a14c55a640535db5c46ce0110df7a44">PICC_CMD_MF_INCREMENT</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:141</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aeb8e5c2ef4ba8719d7ebef85760edbec">PCD_REG_FIFODataReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:38</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aa112c84e0638974eecc772d6e16c7433"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa112c84e0638974eecc772d6e16c7433">PCD_REG_VersionReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:90</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acaed599c1a5ba157455ed438315406c305"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaed599c1a5ba157455ed438315406c305">PICC_CMD_MF_AUTH_KEY_A</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:136</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_afc38269694aaca1081f9327559411724"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#afc38269694aaca1081f9327559411724">MFRC522_MIFARE_Read</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Read(uint8_t blockAddr, uint8_t *buffer, uint8_t *bufferSize)</div><div class="ttdoc">Lit 16 octets (+2 CRC_A) du PICC ACTIF. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1402</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a241b6b48319cb0bcd71dfb7c71550873"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a241b6b48319cb0bcd71dfb7c71550873">PCD_REG_TestSel1Reg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:84</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acab328a35286d092e483fa370d1868e44e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab328a35286d092e483fa370d1868e44e">PICC_CMD_MF_WRITE</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:139</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a358eb8a41e72d3378f64f8028f600cae"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a358eb8a41e72d3378f64f8028f600cae">PCD_REG_ModGsPReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:74</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3a1008b2ed0db7a80ab790224d5c6101"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3a1008b2ed0db7a80ab790224d5c6101">MFRC522_PCD_WriteRegisterArray</a></div><div class="ttdeci">void MFRC522_PCD_WriteRegisterArray(PCD_REG reg, uint8_t count, uint8_t *values)</div><div class="ttdoc">Ecrit un ensemble de valeurs dans un registre du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:231</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a5fc5700e251a02d8b88403905fda17da"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a5fc5700e251a02d8b88403905fda17da">PCD_REG_TestDAC2Reg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:93</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a616cf0f1c0e035e8336b0f20617e7804"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a616cf0f1c0e035e8336b0f20617e7804">PCD_REG_ErrorReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:35</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7afb2bf8b2b3b762f8881f4b50becffbe7">MFRC522_STATUS_ERROR</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:129</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a62f5e4394175e120dec5b47042b80375"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a62f5e4394175e120dec5b47042b80375">MFRC522_PCD_WriteRegister</a></div><div class="ttdeci">void MFRC522_PCD_WriteRegister(PCD_REG reg, uint8_t value)</div><div class="ttdoc">Ecrit une valeur dans un registre du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:210</div></div>
<div class="ttc" id="struct_m_f_r_c522___m_i_f_a_r_e___k_e_y_html_aa5796eb2b87658109033917343626e5d"><div class="ttname"><a href="struct_m_f_r_c522___m_i_f_a_r_e___k_e_y.html#aa5796eb2b87658109033917343626e5d">MFRC522_MIFARE_KEY::keybyte</a></div><div class="ttdeci">uint8_t keybyte[MFRC522_AUTH_KEY_SIZE]</div><div class="ttdef"><b>Definition:</b> MFRC522.h:211</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33aa678740b68bf4ea2037a14599ebd0057"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33aa678740b68bf4ea2037a14599ebd0057">PCD_REG_TCounterValueRegH</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:79</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a537765d799974e532ede36b90d7c2409"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a537765d799974e532ede36b90d7c2409">MFRC522_PCD_ClearRegisterBitMask</a></div><div class="ttdeci">void MFRC522_PCD_ClearRegisterBitMask(PCD_REG reg, uint8_t mask)</div><div class="ttdoc">Inverse le mask sur un regitre donné </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:345</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6eab17aa2fc84ed855b8f0739913068e5ad"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eab17aa2fc84ed855b8f0739913068e5ad">MFRC522_PICC_TYPE_ISO_18092</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:168</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a69b49dba203b00abdb4ad357b6ca525e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a69b49dba203b00abdb4ad357b6ca525e">MFRC522_MIFARE_Increment</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Increment(uint8_t blockAddr, int32_t delta)</div><div class="ttdoc">Ajoute le delta de la valeur stockée à l&#39;adresse du bloc et stock le résultat dans la mémoire volatil...</div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1452</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_af697ac5719bd10495d99085f5e9dca45"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#af697ac5719bd10495d99085f5e9dca45">MFRC522_MIFARE_Classic_SetValue</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Classic_SetValue(uint8_t blockAddr, int32_t value)</div><div class="ttdoc">Ecrit la valeur d&#39;un block d&#39;un PICC MIFARE Classic. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1502</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a6a4b20418e3ddc86f980380cb902d448"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6a4b20418e3ddc86f980380cb902d448">PCD_REG_TModeReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:75</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a34fca9ae70a2078ae9aa791acb68f5b6"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a34fca9ae70a2078ae9aa791acb68f5b6">MFRC522_STATUS_PROPRIETARY_ANTICOLLISION</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:137</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a265b17588bdc955f9efb93719b52895b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a265b17588bdc955f9efb93719b52895b">MFRC522_MIFARE_Ultralight_Write</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Ultralight_Write(uint8_t page, uint8_t *buffer, uint8_t bufferSize)</div><div class="ttdoc">Ecrit 4 octets dans une page du MIFARE Ultralight ACTIF. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1471</div></div>
<div class="ttc" id="struct_m_f_r_c522___p_i_c_c___u_i_d_html_a57246842b6fa5978594cb58f9f4d8df7"><div class="ttname"><a href="struct_m_f_r_c522___p_i_c_c___u_i_d.html#a57246842b6fa5978594cb58f9f4d8df7">MFRC522_PICC_UID::sak</a></div><div class="ttdeci">uint8_t sak</div><div class="ttdef"><b>Definition:</b> MFRC522.h:201</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a38cc59bf61d2bff44a84e0e89db78fbb"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a38cc59bf61d2bff44a84e0e89db78fbb">MFRC522_PCD_PerformSelfTest</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PCD_PerformSelfTest(void)</div><div class="ttdoc">Test automatique du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:484</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a9400548ad6bc1533ae1759ab5633f31e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a9400548ad6bc1533ae1759ab5633f31e">PCD_REG_CollReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:43</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a732edd02a7cbbaae5ce91d4e5db92659"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a732edd02a7cbbaae5ce91d4e5db92659">MFRC522_firmware_referenceV1_0</a></div><div class="ttdeci">const uint8_t PROGMEM MFRC522_firmware_referenceV1_0[]</div><div class="ttdoc">Firmware de la version 1.0 du MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:153</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33ad79b77a72609cf7e4b631057980c480e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ad79b77a72609cf7e4b631057980c480e">PCD_REG_WaterLevelReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:40</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33ac871c1931c8c16ead48a0b25fec172c2"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33ac871c1931c8c16ead48a0b25fec172c2">PCD_REG_AutoTestReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:89</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a2820fbfc5839e179d9fab1192490d91e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a2820fbfc5839e179d9fab1192490d91e">MFRC522_PICC_HaltA</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PICC_HaltA()</div><div class="ttdoc">Envoi une commande Halt type A. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1227</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a47e79ac1154ef547083e9b62ac4560b5"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a47e79ac1154ef547083e9b62ac4560b5">PCD_REG_MfTxReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:59</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6eada76c526ba87176f4f628d82dc4434cb"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eada76c526ba87176f4f628d82dc4434cb">MFRC522_PICC_TYPE_NOT_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:180</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a27c4dca79d3f27e6014245370f88156a"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a27c4dca79d3f27e6014245370f88156a">MFRC522_MIFARE_StopCrypto1</a></div><div class="ttdeci">void MFRC522_MIFARE_StopCrypto1()</div><div class="ttdoc">Stop l&#39;utilisation de l&#39;authentification MIFARE. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1396</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33adaea6b5804a6d640dbff5105949f5404"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33adaea6b5804a6d640dbff5105949f5404">PCD_REG_ComIrqReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:33</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a39abb1141be87a84f525ea22f555ab20"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a39abb1141be87a84f525ea22f555ab20">MFRC522_PCD_AntennaOff</a></div><div class="ttdeci">void MFRC522_PCD_AntennaOff()</div><div class="ttdoc">Eteint l&#39;antenne. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:421</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a75dc0fdffad4fc369637e38d39378386">MFRC522_STATUS_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:131</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca6cd44287b13b4ac175b38bde5ef61f5b"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca6cd44287b13b4ac175b38bde5ef61f5b">PICC_CMD_SEL_CL1</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:129</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a726602bea63c4885fc4b14c16a2bec17">PCD_CMD_Transceive</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:114</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a88c1a46eaee837f136ab9ad8caa01b95"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a88c1a46eaee837f136ab9ad8caa01b95">MFRC522_PCD_Reset</a></div><div class="ttdeci">void MFRC522_PCD_Reset()</div><div class="ttdoc">Réinitialise le composant MFRC522. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:402</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a66c6e7b431d9c23df53dde3b31c44ab5"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a66c6e7b431d9c23df53dde3b31c44ab5">MFRC522_STATUS_COLLISION</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:130</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a8b7b2abc49823383fc4ac7cf89709007"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a8b7b2abc49823383fc4ac7cf89709007">MFRC522_STATUS_BCC_ERROR</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:138</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acaebf925b876166923f98130644349e6ec"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acaebf925b876166923f98130644349e6ec">PICC_CMD_MF_RESTORE</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:142</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a19dad8f8313437c0428a8e885aa78042"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a19dad8f8313437c0428a8e885aa78042">PCD_REG_DemodReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:56</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aa1ba0ad4f22036448751f56d80a63b59"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aa1ba0ad4f22036448751f56d80a63b59">MFRC522_MIFARE_Authenticate</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Authenticate(MFRC522_AUTH_KEY keytype, uint8_t blockAddr, MFRC522_MIFARE_KEY *key, MFRC522_PICC_UID *uid)</div><div class="ttdoc">Effectue l&#39;authentification MIFARE sur un block spécifié </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1365</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_ae22e3494c692b83c6ce6918cfdec9de5"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#ae22e3494c692b83c6ce6918cfdec9de5">MFRC522_PCD_CalculateCRC</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_PCD_CalculateCRC(uint8_t *data, uint8_t length, uint16_t *result)</div><div class="ttdoc">Calcul le CRC d&#39;un tableau. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:363</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500aca09929cac708d474115bdcb25f3d61f81"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500aca09929cac708d474115bdcb25f3d61f81">PICC_CMD_UL_WRITE</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:146</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_acd5263773974b6a152486da112de524f"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#acd5263773974b6a152486da112de524f">MFRC522_MIFARE_Classic_GetValue</a></div><div class="ttdeci">MFRC522_STATUS MFRC522_MIFARE_Classic_GetValue(uint8_t blockAddr, int32_t *value)</div><div class="ttdoc">Lit la valeur d&#39;un block d&#39;un PICC MIFARE Classic. </div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:1484</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a116f7cb59d581b6d5f215865aa7d6129a8f646ea639231f41c7adef64ef256792"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a116f7cb59d581b6d5f215865aa7d6129a8f646ea639231f41c7adef64ef256792">PCD_CMD_CalcCRC</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:110</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a8ed729867f3e31ba760da8cdf874c9d7a9cfb9908f0583d4cfb7b789511c61e67"><div class="ttname"><a href="_m_f_r_c522_8h.html#a8ed729867f3e31ba760da8cdf874c9d7a9cfb9908f0583d4cfb7b789511c61e67">MFRC522_STATUS_INTERNAL_ERROR</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:133</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea5bdab066171aabf26e4a51a6b6f82abc"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea5bdab066171aabf26e4a51a6b6f82abc">MFRC522_PICC_TYPE_MIFARE_UL</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:172</div></div>
<div class="ttc" id="_s_p_i__master_8h_html_afe52fd1b883a29133b7a8974837e0c4b"><div class="ttname"><a href="_s_p_i__master_8h.html#afe52fd1b883a29133b7a8974837e0c4b">SPI_Initialize</a></div><div class="ttdeci">void SPI_Initialize(void)</div><div class="ttdoc">Initialise l&#39;interface SPI. </div><div class="ttdef"><b>Definition:</b> SPI_master_core.h:18</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6ea7e9a94106c447f4bf2961d0c5fe5557b"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6ea7e9a94106c447f4bf2961d0c5fe5557b">MFRC522_PICC_TYPE_MIFARE_DESFIRE</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:175</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acae53647ddb4c2765fff8814805310113c"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acae53647ddb4c2765fff8814805310113c">PICC_CMD_CT</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:128</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a62df1eebf0e1a19452da8ba6d05fea5e"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a62df1eebf0e1a19452da8ba6d05fea5e">PCD_REG_CRCResultRegH</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:66</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a1878873f3f0b1e4fe42901727fb1d048"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a1878873f3f0b1e4fe42901727fb1d048">PCD_REG_TReloadRegL</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:78</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a212296f8a300a8d955bf23e59b676853">PCD_REG_FIFOLevelReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:39</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33af1a20c58c7ab38f5ad570897536a13b8"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33af1a20c58c7ab38f5ad570897536a13b8">PCD_REG_SerialSpeedReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:62</div></div>
<div class="ttc" id="_m_f_r_c522_8h_html_a1ab910a4592d91fed8ceb9c8f2014c6eacda3341fc8f2e14b82d48fe3557e6859"><div class="ttname"><a href="_m_f_r_c522_8h.html#a1ab910a4592d91fed8ceb9c8f2014c6eacda3341fc8f2e14b82d48fe3557e6859">MFRC522_PICC_TYPE_MPCOS</a></div><div class="ttdef"><b>Definition:</b> MFRC522.h:179</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_aae4e5280594d2e5f826bd6bca0539a33a6f0c083085742b3390c0251ebaa1734d"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#aae4e5280594d2e5f826bd6bca0539a33a6f0c083085742b3390c0251ebaa1734d">PCD_REG_ModeReg</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:48</div></div>
<div class="ttc" id="_m_f_r_c522__core_8h_html_a3134ed1e3da141b3f1c85a98b9a500acab072baf2abb9cadd0205b8809bf0de95"><div class="ttname"><a href="_m_f_r_c522__core_8h.html#a3134ed1e3da141b3f1c85a98b9a500acab072baf2abb9cadd0205b8809bf0de95">PICC_CMD_SEL_CL2</a></div><div class="ttdef"><b>Definition:</b> MFRC522_core.h:130</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8a1472a16bc50042bedc625d34a1b978.html">include</a></li><li class="navelem"><a class="el" href="dir_e84ef27972f99cf3b185eb9e1c9ed32a.html">RFID</a></li><li class="navelem"><a class="el" href="_m_f_r_c522__core_8h.html">MFRC522_core.h</a></li>
    <li class="footer">Généré le Dimanche 21 Juin 2015 16:01:55 pour avr.sdk par
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
